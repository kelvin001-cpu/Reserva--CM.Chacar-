<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI 2026 - KELVIN MASTER</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --azul-sky: #00adef; --neon: #00ff9d; --danger: #ff4757; --warning: #ffb102; }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; transition: 0.3s; }
        body { margin: 0; background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') no-repeat center center fixed; background-size: cover; min-height: 100vh; display: flex; align-items: center; justify-content: center; color: white; overflow: hidden; }
        
        .balao-premium { width: 95%; max-width: 550px; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 25px; padding: 25px; box-shadow: 0 25px 50px rgba(0,0,0,0.6); position: relative; }
        .hidden { display: none !important; }
        
        /* BotÃµes de Menu Estilo Superior */
        .btn-menu { width: 100%; height: 55px; border-radius: 15px; border: none; background: linear-gradient(135deg, #004a99, var(--azul-sky)); color: white; font-weight: 700; cursor: pointer; margin-bottom: 12px; font-size: 13px; text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-menu:hover { transform: scale(1.02); box-shadow: 0 0 15px var(--azul-sky); }
        .btn-chamado { background: linear-gradient(135deg, #d35400, #e67e22); }
        .btn-gestor { background: rgba(255,255,255,0.1); border: 1px solid var(--azul-sky); }

        /* Listas e Cronograma */
        .visor-dados { background: rgba(0,0,0,0.5); border-radius: 15px; padding: 15px; margin-top: 15px; max-height: 200px; overflow-y: auto; text-align: left; border-left: 4px solid var(--azul-sky); }
        .item-log { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 12px; }
        .status-tag { float: right; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        input, select { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 10px; border: none; font-weight: 600; color: #111; }
        #relogio { text-align: right; font-size: 11px; color: var(--azul-sky); margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body onload="app.init()">

    <div class="balao-premium">
        <div id="relogio">00/00/0000 00:00:00</div>

        <div id="section-login">
            <h2 style="text-align:center;">NTI MASTER 2026</h2>
            <select id="cargo-select" onchange="app.ajustarInterface()">
                <option value="PROF">Portal Professor</option>
                <option value="SEC">Portal Secretaria</option>
                <option value="GEST">Portal GestÃ£o</option>
            </select>
            <input type="number" id="prontuario" placeholder="ProntuÃ¡rio" oninput="app.identificar(this.value)">
            
            <div id="area-cadastro" class="hidden">
                <input type="text" id="nome" placeholder="Nome Completo">
                <input type="text" id="materia" class="hidden" placeholder="Disciplina / MatÃ©ria">
            </div>

            <input type="password" id="senha" placeholder="Senha">
            <button class="btn-menu" onclick="app.entrar()">ACESSAR NUCLEO</button>
        </div>

        <div id="section-portal" class="hidden">
            <h3 id="boas-vindas" style="margin-bottom: 5px;">OlÃ¡, UsuÃ¡rio</h3>
            <span id="cargo-tag" style="color: var(--azul-sky); font-size: 12px; font-weight: bold;">CARGO</span>
            
            <div style="margin-top: 20px;">
                <button class="btn-menu" onclick="app.novaReserva()">ðŸ“… RESERVAR EQUIPAMENTO</button>
                <button class="btn-menu btn-chamado" onclick="app.novoChamado()">ðŸ†˜ ABRIR CHAMADO TI</button>
            </div>

            <div class="visor-dados">
                <p style="font-size: 11px; color: var(--azul-sky); margin-bottom: 8px;">ðŸ•’ CRONOGRAMA DE USO</p>
                <div id="lista-cronograma"></div>
            </div>

            <button onclick="location.reload()" style="background:none; border:none; color:#666; font-size:11px; margin-top:15px; cursor:pointer;">DESCONECTAR</button>
        </div>

        <div id="section-gestao" class="hidden">
            <h3>MONITORAMENTO NTI</h3>
            <p style="font-size: 12px; color: #888;">VisÃ£o estratÃ©gica de recursos</p>

            <div class="visor-dados" style="max-height: 140px;">
                <p style="font-size: 11px; color: var(--neon);">âœ… RESERVAS ATIVAS</p>
                <div id="gestao-reservas"></div>
            </div>

            <div class="visor-dados" style="max-height: 140px; border-left-color: var(--danger);">
                <p style="font-size: 11px; color: var(--danger);">ðŸš¨ CHAMADOS PENDENTES</p>
                <div id="gestao-chamados"></div>
            </div>

            <button onclick="location.reload()" class="btn-menu" style="background:#222; margin-top:20px;">SAIR</button>
        </div>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        role: '', user: null, existe: false,

        init() {
            setInterval(() => { document.getElementById('relogio').innerText = new Date().toLocaleString(); }, 1000);
            this.ajustarInterface();
            this.ouvirDados();
        },

        ajustarInterface() {
            this.role = document.getElementById('cargo-select').value;
            this.identificar(document.getElementById('prontuario').value);
        },

        async identificar(p) {
            if(p.length < 3) return;
            const snap = await db.ref(`usuarios/${this.role}/${p}`).once('value');
            this.existe = snap.exists();
            
            document.getElementById('area-cadastro').classList.toggle('hidden', this.existe);
            document.getElementById('materia').classList.toggle('hidden', this.role !== 'PROF' || this.existe);
        },

        async entrar() {
            const p = document.getElementById('prontuario').value;
            const s = document.getElementById('senha').value;

            if(this.existe) {
                const snap = await db.ref(`usuarios/${this.role}/${p}`).once('value');
                this.user = snap.val();
                if(this.user.senha === s) this.abrirPortal(); else alert("Senha Incorreta!");
            } else {
                const n = document.getElementById('nome').value;
                const m = document.getElementById('materia').value || 'N/A';
                if(!n || !s) return alert("Preencha o cadastro!");
                this.user = { pront: p, nome: n, senha: s, materia: m, cargo: this.role };
                await db.ref(`usuarios/${this.role}/${p}`).set(this.user);
                this.abrirPortal();
            }
        },

        abrirPortal() {
            document.getElementById('section-login').classList.add('hidden');
            if(this.role === 'GEST') {
                document.getElementById('section-gestao').classList.remove('hidden');
            } else {
                document.getElementById('section-portal').classList.remove('hidden');
                document.getElementById('boas-vindas').innerText = "OlÃ¡, " + this.user.nome;
                document.getElementById('cargo-tag').innerText = "PORTAL " + (this.role === 'PROF' ? 'PROFESSOR' : 'SECRETARIA');
            }
        },

        novaReserva() {
            const item = prompt("Equipamento (Ex: Kit RobÃ³tica, Notebook):");
            const h = prompt("HorÃ¡rio (Ex: 14:00 Ã s 15:30):");
            if(item && h) db.ref('reservas').push({ item, h, nome: this.user.nome, status: 'EM USO' });
        },

        novoChamado() {
            const msg = prompt("Descreva o problema para o TI:");
            if(msg) db.ref('chamados').push({ msg, nome: this.user.nome, status: 'PENDENTE' });
        },

        ouvirDados() {
            // Cronograma Professor/Secretaria
            db.ref('reservas').on('value', snap => {
                const list = document.getElementById('lista-cronograma');
                const gest = document.getElementById('gestao-reservas');
                list.innerHTML = ""; gest.innerHTML = "";
                snap.forEach(d => {
                    const r = d.val();
                    const html = `<div class="item-log"><b>${r.item}</b> - ${r.nome} <span class="status-tag" style="color:var(--neon)">${r.h}</span></div>`;
                    list.innerHTML += html;
                    gest.innerHTML += html;
                });
            });

            // Chamados para GestÃ£o
            db.ref('chamados').on('value', snap => {
                const gest = document.getElementById('gestao-chamados');
                gest.innerHTML = "";
                snap.forEach(d => {
                    const c = d.val();
                    gest.innerHTML += `<div class="item-log"><b>${c.nome}:</b> ${c.msg} <span class="status-tag" style="color:var(--danger)">${c.status}</span></div>`;
                });
            });
        }
    }
</script>
</body>
</html>
