<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTI MASTER - SISTEMA OPERACIONAL</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --azul: #00adef; --neon: #00ff9d; --glass: rgba(255, 255, 255, 0.1); }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { margin: 0; background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') no-repeat center center fixed; background-size: cover; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .container { background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); padding: 25px; border-radius: 20px; border: 1px solid var(--glass); width: 95%; max-width: 700px; text-align: center; }
        .hidden { display: none !important; }

        /* Estilo dos Menus */
        .grid-menu { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 20px 0; }
        .btn-menu { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; color: white; cursor: pointer; font-size: 12px; transition: 0.3s; }
        .btn-menu:hover { background: var(--azul); transform: translateY(-3px); }

        /* Listas e Cronograma */
        .secao-dados { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; margin-top: 15px; text-align: left; max-height: 300px; overflow-y: auto; }
        .item-row { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; }
        .btn-principal { width: 100%; padding: 15px; background: var(--azul); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        .tag { padding: 3px 7px; border-radius: 5px; font-size: 10px; font-weight: bold; text-transform: uppercase; }
        .tag-reserva { background: var(--neon); color: black; }
        .tag-chamado { background: #ff4757; color: white; }
    </style>
</head>
<body onload="app.init()">

    <div class="container">
        <div id="tela-login">
            <h2>NTI MASTER</h2>
            <select id="cargo" onchange="app.verificarCampos()">
                <option value="professores">Portal Professor</option>
                <option value="secretaria">Portal Secretaria</option>
                <option value="gestores">Portal Gest√£o</option>
            </select>
            <input type="number" id="pront" placeholder="Prontu√°rio" oninput="app.checarDB(this.value)">
            <div id="cadastro" class="hidden">
                <input type="text" id="nome" placeholder="Nome Completo">
                <input type="text" id="materia" placeholder="Mat√©ria (S√≥ Prof)">
            </div>
            <input type="password" id="senha" placeholder="Senha">
            <button class="btn-principal" onclick="app.entrar()">ENTRAR NO NTI</button>
        </div>

        <div id="dash" class="hidden">
            <div style="display:flex; justify-content: space-between; border-bottom: 1px solid var(--glass); padding-bottom: 10px;">
                <span id="nome-user">Usu√°rio</span>
                <span id="cargo-user" style="color: var(--azul); font-weight: bold;">CARGO</span>
            </div>

            <div id="menu-contexto" class="grid-menu">
                </div>

            <div class="secao-dados">
                <h4 id="titulo-lista" style="margin:0 0 10px 0; font-size: 14px; color: var(--azul);">Cronograma de Reservas</h4>
                <div id="lista-conteudo">
                    </div>
            </div>

            <button onclick="location.reload()" style="background:none; border:none; color:#555; margin-top:15px; cursor:pointer;">Sair do Portal</button>
        </div>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null,
        existe: false,

        init() { this.verificarCampos(); },

        verificarCampos() {
            const cargo = document.getElementById('cargo').value;
            document.getElementById('materia').style.display = (cargo === 'professores') ? 'block' : 'none';
        },

        async checarDB(p) {
            if(p.length < 3) return;
            const cargo = document.getElementById('cargo').value;
            const snap = await db.ref(`usuarios/${cargo}/${p}`).once('value');
            this.existe = snap.exists();
            document.getElementById('cadastro').classList.toggle('hidden', this.existe);
        },

        async entrar() {
            const c = document.getElementById('cargo').value;
            const p = document.getElementById('pront').value;
            const s = document.getElementById('senha').value;

            if(this.existe) {
                const snap = await db.ref(`usuarios/${c}/${p}`).once('value');
                this.user = snap.val();
                if(this.user.senha === s) this.carregarDash(); else alert("Erro na senha");
            } else {
                const n = document.getElementById('nome').value;
                const m = document.getElementById('materia').value || "N/A";
                if(!n || !s) return alert("Preencha tudo");
                this.user = { nome: n, pront: p, senha: s, materia: m, cargo: c };
                await db.ref(`usuarios/${c}/${p}`).set(this.user);
                this.carregarDash();
            }
        },

        carregarDash() {
            document.getElementById('tela-login').classList.add('hidden');
            document.getElementById('dash').classList.remove('hidden');
            document.getElementById('nome-user').innerText = "Ol√°, " + this.user.nome;
            document.getElementById('cargo-user').innerText = this.user.cargo.toUpperCase();
            
            this.montarMenu();
            this.atualizarListas();
        },

        montarMenu() {
            const menu = document.getElementById('menu-contexto');
            menu.innerHTML = ""; // Limpa

            // Bot√µes baseados no Cargo
            if(this.user.cargo === 'professores' || this.user.cargo === 'secretaria') {
                menu.innerHTML += `<button class="btn-menu" onclick="app.acao('reserva')">üìÖ Nova Reserva</button>`;
                menu.innerHTML += `<button class="btn-menu" onclick="app.acao('chamado')">üÜò Abrir Chamado TI</button>`;
                menu.innerHTML += `<button class="btn-menu" onclick="app.acao('crono')">üïí Meu Cronograma</button>`;
            } else if(this.user.cargo === 'gestores') {
                menu.innerHTML += `<button class="btn-menu" onclick="app.atualizarListas('reservas')">üìä Monitor Reservas</button>`;
                menu.innerHTML += `<button class="btn-menu" onclick="app.atualizarListas('chamados')">üìã Ver Chamados TI</button>`;
                menu.innerHTML += `<button class="btn-menu" style="background:var(--neon); color:black">üñ®Ô∏è Relat√≥rios</button>`;
            }
        },

        acao(tipo) {
            if(tipo === 'reserva') {
                const item = prompt("Qual equipamento? (Ex: Kit Rob√≥tica, Notebook)");
                const hora = prompt("Hor√°rio da reserva?");
                if(item && hora) db.ref('reservas').push({ user: this.user.nome, item, hora, status: 'EM USO' });
            } else if(tipo === 'chamado') {
                const problema = prompt("Descreva o problema t√©cnico:");
                if(problema) db.ref('chamados').push({ user: this.user.nome, problema, status: 'PENDENTE' });
            }
        },

        atualizarListas(filtro = 'reservas') {
            const lista = document.getElementById('lista-conteudo');
            const titulo = document.getElementById('titulo-lista');
            
            if(filtro === 'reservas') {
                titulo.innerText = "Cronograma de Reservas";
                db.ref('reservas').on('value', snap => {
                    lista.innerHTML = "";
                    snap.forEach(d => {
                        const v = d.val();
                        lista.innerHTML += `
                            <div class="item-row">
                                <span><b>${v.item}</b> - ${v.user}</span>
                                <span><span class="tag tag-reserva">${v.hora}</span></span>
                            </div>`;
                    });
                });
            } else {
                titulo.innerText = "Monitor de Chamados TI";
                db.ref('chamados').on('value', snap => {
                    lista.innerHTML = "";
                    snap.forEach(d => {
                        const v = d.val();
                        lista.innerHTML += `
                            <div class="item-row">
                                <span><b>${v.user}:</b> ${v.problema}</span>
                                <span><span class="tag tag-chamado">${v.status}</span></span>
                            </div>`;
                    });
                });
            }
        }
    }
</script>
</body>
</html>
