<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MASTER CONTROL | NTI Kelvin</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #00adef; --danger: #ff4757; --warning: #ffa502; --success: #00ff9d; --dark: #0f172a; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar lateral */
        nav { width: 280px; background: #000; padding: 20px; border-right: 2px solid var(--primary); display: flex; flex-direction: column; gap: 10px; }
        .nav-link { padding: 12px; border-radius: 8px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 10px; color: #888; }
        .nav-link:hover, .nav-link.active { background: var(--primary); color: white; }
        
        /* √Årea Principal */
        main { flex: 1; padding: 30px; overflow-y: auto; background: rgba(0,0,0,0.3); }
        .card { background: rgba(30, 41, 59, 0.7); padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        
        /* Bot√£o de P√¢nico / Alerta NTI */
        .panic-zone { border: 2px dashed var(--danger); padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        
        /* Estilo de Tabelas e Listas */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        
        button { cursor: pointer; border: none; border-radius: 6px; padding: 8px 12px; font-weight: 600; transition: 0.2s; }
        .btn-freeze { background: var(--warning); color: black; }
        .btn-danger { background: var(--danger); color: white; }
        
        .hidden { display: none; }
        input, select { background: #000; border: 1px solid #444; color: white; padding: 8px; border-radius: 5px; width: 100%; }
    </style>
</head>
<body>

<nav>
    <h2 style="color:var(--primary)">NTI MASTER</h2>
    <div class="nav-link active" onclick="show('v-monitor')"><i class="fa fa-tv"></i> Monitoramento</div>
    <div class="nav-link" onclick="show('v-users')"><i class="fa fa-users"></i> Gest√£o de Usu√°rios</div>
    <div class="nav-link" onclick="show('v-secretaria')"><i class="fa fa-pen-to-square"></i> Reserva Secretaria</div>
    <div class="nav-link" onclick="show('v-panic')"><i class="fa fa-bullhorn"></i> Alerta Global (TI)</div>
    <div style="margin-top: auto; padding: 10px; font-size: 10px; color: var(--primary);">ESTAGI√ÅRIO KELVIN ALMEIDA ¬© 2026</div>
</nav>

<main>
    <div id="v-monitor" class="view">
        <h1>Monitoramento em Tempo Real</h1>
        <div class="card">
            <h3>Atividades de Hoje</h3>
            <table id="table-atividades">
                <thead><tr><th>Usu√°rio</th><th>Item</th><th>Local</th><th>Status</th><th>A√ß√£o</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <div id="v-users" class="view hidden">
        <h1>Controle de Acessos</h1>
        <div class="card">
            <table>
                <thead><tr><th>Nome</th><th>Prontu√°rio</th><th>Tipo</th><th>Status</th><th>A√ß√µes</th></tr></thead>
                <tbody id="lista-usuarios"></tbody>
            </table>
        </div>
    </div>

    <div id="v-secretaria" class="view hidden">
        <h1>Painel da Secretaria</h1>
        <div class="card" style="max-width: 500px;">
            <label>Nome do Respons√°vel (Secretaria)</label>
            <input type="text" id="sec-nome" placeholder="Ex: Ronaldo 46690">
            <label>Equipamento</label>
            <select id="sec-item">
                <option>TV 01</option><option>TV 02</option><option>SALA INFORM√ÅTICA</option><option>CARRINHO TABLETS</option>
            </select>
            <label>Sala</label>
            <input type="text" id="sec-sala" placeholder="Destino">
            <button onclick="reservaSecretaria()" style="background:var(--success); width:100%; margin-top:15px; color:black;">GERAR RESERVA OFICIAL</button>
        </div>
    </div>

    <div id="v-panic" class="view hidden">
        <h1 style="color:var(--danger)">Protocolo de Emerg√™ncia NTI</h1>
        <div class="card panic-zone">
            <h3>Gerador de Aviso de Sistema</h3>
            <p>Isso aparecer√° para todos os usu√°rios e pode "congelar" as fun√ß√µes do site.</p>
            <select id="panic-grav">
                <option value="none">üü¢ Normal (Nenhum aviso)</option>
                <option value="aviso">üü° Aviso (Apenas Mensagem)</option>
                <option value="bloqueio">üî¥ BLOQUEIO TOTAL (Manuten√ß√£o)</option>
            </select>
            <textarea id="panic-msg" style="margin-top:10px; height:100px;" placeholder="Mensagem de aviso para a escola..."></textarea>
            <button onclick="dispararAlerta()" style="background:var(--danger); width:100%; margin-top:15px; font-size:18px;">ATUALIZAR STATUS GLOBAL</button>
        </div>
    </div>
</main>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function show(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        event.currentTarget.classList.add('active');
    }

    // Carregar Monitoramento
    db.ref('atividades').on('value', snap => {
        const tbody = document.querySelector('#table-atividades tbody');
        tbody.innerHTML = "";
        snap.forEach(a => {
            const d = a.val();
            if(d.status === 'ativo') {
                tbody.innerHTML += `<tr>
                    <td>${d.prof}</td>
                    <td><b>${d.equip}</b></td>
                    <td>${d.sala}</td>
                    <td><span class="status-dot" style="background:var(--success)"></span> Ativo</td>
                    <td><button onclick="remover('${a.key}')" class="btn-danger">Encerrar</button></td>
                </tr>`;
            }
        });
    });

    // Carregar Usu√°rios
    db.ref('usuarios').on('value', snap => {
        const list = document.getElementById('lista-usuarios');
        list.innerHTML = "";
        snap.forEach(u => {
            const user = u.val();
            const isFrozen = user.status === 'bloqueado';
            list.innerHTML += `<tr>
                <td>${user.nome}</td>
                <td>${user.pront}</td>
                <td>${user.materia || 'Secretaria'}</td>
                <td style="color:${isFrozen ? 'var(--danger)' : 'var(--success)'}">${user.status || 'Ativo'}</td>
                <td>
                    <button onclick="resetar('${user.pront}')" style="background:#444; color:white;">Reset Senha</button>
                    <button onclick="congelar('${user.pront}', '${isFrozen}')" class="btn-freeze">${isFrozen ? 'Descongelar' : 'Congelar'}</button>
                    <button onclick="apagarUsuario('${user.pront}')" class="btn-danger"><i class="fa fa-trash"></i></button>
                </td>
            </tr>`;
        });
    });

    // A√ß√µes de TI
    function resetar(pront) {
        db.ref('usuarios/'+pront).update({ pass: 'Pmsp2026' });
        alert("Senha resetada para: Pmsp2026");
    }

    function congelar(pront, atual) {
        const novoStatus = (atual === 'true') ? 'Ativo' : 'bloqueado';
        db.ref('usuarios/'+pront).update({ status: novoStatus });
    }

    function apagarUsuario(pront) {
        if(confirm("Deseja apagar este usu√°rio definitivamente?")) db.ref('usuarios/'+pront).remove();
    }

    function dispararAlerta() {
        const g = document.getElementById('panic-grav').value;
        const m = document.getElementById('panic-msg').value;
        db.ref('sistema_status').set({ gravidade: g, msg: m });
        alert("Alerta Global Atualizado!");
    }

    function reservaSecretaria() {
        const n = document.getElementById('sec-nome').value;
        const e = document.getElementById('sec-item').value;
        const s = document.getElementById('sec-sala').value;
        if(!n || !s) return alert("Preencha tudo!");
        db.ref('atividades').push({ equip: e, prof: n + " (SECRETARIA)", sala: s, status: 'ativo', fim: 'Oficial' });
        alert("Reserva da Secretaria Registrada!");
    }

    function remover(key) { db.ref('atividades/'+key).update({ status: 'concluido' }); }
</script>
</body>
</html>
