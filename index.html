<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Kelvin Almeida</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00adef; --accent: #00ff9d; --danger: #ff4757;
            --dark: #0f172a; --glass: rgba(15, 23, 42, 0.95);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background: #020617; color: white;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- CRÉDITOS --- */
        .footer-credits { 
            position: fixed; bottom: 10px; right: 20px; font-size: 11px; 
            color: var(--primary); text-align: right; z-index: 100;
        }

        /* --- TELA DE LOGIN (PORTAIS SEPARADOS) --- */
        #screen-auth {
            position: fixed; inset: 0; background: url('https://images.unsplash.com/photo-1510511459019-5dee997ddfdf?q=80&w=2070') center/cover;
            z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow-y: auto; padding: 40px 0;
        }

        .intro-text {
            max-width: 600px; text-align: center; background: var(--glass); 
            padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid var(--primary);
            font-size: 13px; line-height: 1.6;
        }

        .portal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; width: 90%; max-width: 1100px; }
        
        .login-card { 
            background: var(--glass); padding: 25px; border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
        }
        .login-card i { font-size: 35px; color: var(--primary); margin-bottom: 15px; }
        .login-card h2 { font-size: 16px; margin: 0 0 15px 0; letter-spacing: 1px; }

        /* --- LAYOUT PRINCIPAL --- */
        .app-container { display: flex; flex: 1; width: 100%; height: 100%; }
        
        nav { 
            width: 260px; background: #000; border-right: 1px solid #1e293b; 
            padding: 20px; display: flex; flex-direction: column; gap: 10px;
        }

        .nav-item { 
            padding: 12px 15px; border-radius: 10px; cursor: pointer; 
            display: flex; align-items: center; gap: 12px; transition: 0.3s; color: #94a3b8;
        }
        .nav-item:hover, .nav-item.active { background: var(--primary); color: white; }

        main { flex: 1; padding: 30px; overflow-y: auto; background: rgba(15, 23, 42, 0.5); }
        
        .card { background: var(--glass); padding: 20px; border-radius: 15px; border: 1px solid #1e293b; margin-bottom: 20px; }
        
        /* --- UTILITÁRIOS --- */
        input { width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-p { background: var(--primary); color: white; }
        .btn-p:hover { filter: brightness(1.2); }
        .hidden { display: none !important; }

        .banner-alert { background: var(--danger); color: white; padding: 10px; text-align: center; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="banner-ti" class="banner-alert">⚠️ AVISO DO TI: <span id="banner-text"></span></div>

    <div id="screen-auth">
        <h1 style="color: var(--primary); font-size: 32px; margin-bottom: 5px;">SISTEMA NTI</h1>
        
        <div class="intro-text">
            Este sistema foi desenvolvido para facilitar a gestão de professores e gestores, 
            otimizando o controle de equipamentos e elevando o progresso da tecnologia na educação, 
            preparando nossas escolas para o futuro da inovação.
        </div>

        <div class="portal-grid">
            <div class="login-card">
                <i class="fa fa-apple-whole"></i>
                <h2>PORTAL PROFESSOR</h2>
                <input type="number" id="p-pront" placeholder="Prontuário">
                <input type="password" id="p-pass" placeholder="Senha">
                <button class="btn btn-p" onclick="app.login('Professor')">ENTRAR</button>
                <button class="btn" style="font-size: 10px; background: transparent; color: #94a3b8;" onclick="app.abrirCad('Professor')">Cadastrar Professor</button>
            </div>

            <div class="login-card">
                <i class="fa fa-file-signature"></i>
                <h2>SECRETARIA</h2>
                <input type="number" id="s-pront" placeholder="Prontuário">
                <input type="password" id="s-pass" placeholder="Senha">
                <button class="btn btn-p" onclick="app.login('Secretaria')">ENTRAR</button>
                <button class="btn" style="font-size: 10px; background: transparent; color: #94a3b8;" onclick="app.abrirCad('Secretaria')">Cadastrar Secretaria</button>
            </div>

            <div class="login-card">
                <i class="fa fa-shield-halved"></i>
                <h2>GESTÃO</h2>
                <input type="number" id="g-pront" placeholder="Prontuário">
                <input type="password" id="g-pass" placeholder="Senha">
                <button class="btn btn-p" onclick="app.login('Gestão')">ENTRAR</button>
                <button class="btn" style="font-size: 10px; background: transparent; color: #94a3b8;" onclick="app.abrirCad('Gestão')">Cadastrar Gestor</button>
            </div>

            <div class="login-card" style="border-color: var(--accent);">
                <i class="fa fa-microchip" style="color: var(--accent);"></i>
                <h2>TI MASTER</h2>
                <input type="number" id="t-pront" placeholder="Prontuário Master">
                <input type="password" id="t-pass" placeholder="Senha TI">
                <button class="btn" style="background: var(--accent); color: #000;" onclick="app.login('TI')">TERMINAL TI</button>
            </div>
        </div>
    </div>

    <div id="modal-cad" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:6000; display:flex; align-items:center; justify-content:center;">
        <div class="login-card" style="width: 350px;">
            <h2 id="cad-title">Cadastro</h2>
            <input type="text" id="c-nome" placeholder="Nome Completo">
            <input type="number" id="c-pront-new" placeholder="Prontuário">
            <button class="btn btn-p" onclick="app.executarCadastro()">FINALIZAR</button>
            <button class="btn" onclick="document.getElementById('modal-cad').classList.add('hidden')">CANCELAR</button>
        </div>
    </div>

    <div class="app-container">
        <nav id="sidebar" class="hidden">
            <div style="padding: 10px; text-align: center; border-bottom: 1px solid #1e293b; margin-bottom: 20px;">
                <span id="user-name" style="font-weight: bold; color: var(--primary);">Usuário</span><br>
                <small id="user-cargo" style="font-size: 10px; opacity: 0.6;"></small>
            </div>

            <div class="nav-item active" onclick="app.view('v-dash')"><i class="fa fa-chart-line"></i> Dashboard</div>
            
            <div id="menu-prof" class="hidden">
                <div class="nav-item" onclick="app.view('v-reserva')"><i class="fa fa-calendar-plus"></i> Reservar Item</div>
            </div>

            <div id="menu-gestao" class="hidden">
                <div class="nav-item" onclick="app.view('v-monitor')"><i class="fa fa-eye"></i> Monitoramento</div>
            </div>

            <div id="menu-ti" class="hidden">
                <div class="nav-item" style="color: var(--accent);" onclick="app.view('v-ti')"><i class="fa fa-terminal"></i> Terminal TI</div>
            </div>

            <button class="btn btn-danger" style="margin-top: auto; background: var(--danger);" onclick="location.reload()">SAIR</button>
        </nav>

        <main id="main-content" class="hidden">
            <div id="v-dash" class="content-view">
                <h2>Dashboard Principal</h2>
                <div id="dash-list">Nenhuma reserva ativa no momento.</div>
            </div>

            <div id="v-reserva" class="content-view hidden">
                <h3>Equipamentos</h3>
                <div id="grid-equip" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px;"></div>
            </div>

            <div id="v-monitor" class="content-view hidden">
                <h3>Monitoramento de Professores</h3>
                <div class="card">
                    <table style="width: 100%; text-align: left; border-collapse: collapse;">
                        <thead><tr style="color: var(--primary);"><th>Usuário</th><th>Item</th><th>Local</th><th>Início</th></tr></thead>
                        <tbody id="table-monitor"></tbody>
                    </table>
                </div>
            </div>

            <div id="v-ti" class="content-view hidden">
                <h2 style="color: var(--accent);">Painel de Controle TI</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="card">
                        <h4>SISTEMA</h4>
                        <button class="btn" style="background: var(--danger);" onclick="app.tiControl('lockdown', true)">CONGELAR TUDO</button>
                        <button class="btn" style="background: #22c55e;" onclick="app.tiControl('lockdown', false)">LIBERAR</button>
                    </div>
                    <div class="card">
                        <h4>AVISO GLOBAL</h4>
                        <input type="text" id="ti-input-msg" placeholder="Mensagem para o banner...">
                        <button class="btn btn-p" onclick="app.tiControl('banner', true)">POSTAR AVISO</button>
                        <button class="btn" onclick="app.tiControl('banner', false)">REMOVER</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="footer-credits">
        Kelvin Almeida estagiário do programa conect desenvolveu sistema NTI
    </div>

<script>
    // CONFIGURAÇÃO FIREBASE
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null,
        tempCargo: '',

        abrirCad(cargo) {
            this.tempCargo = cargo;
            document.getElementById('cad-title').innerText = "Cadastro: " + cargo;
            document.getElementById('modal-cad').classList.remove('hidden');
        },

        async executarCadastro() {
            const nome = document.getElementById('c-nome').value;
            const pront = document.getElementById('c-pront-new').value;
            if(!nome || !pront) return alert("Preencha tudo!");

            await db.ref('usuarios/' + pront).set({
                nome: nome, pront: pront, cargo: this.tempCargo,
                pass: 'pmsp2026', status: 'ativo'
            });
            alert("Sucesso! Senha: pmsp2026");
            document.getElementById('modal-cad').classList.add('hidden');
        },

        async login(cargo) {
            let p, s;
            if(cargo === 'Professor') { p = document.getElementById('p-pront').value; s = document.getElementById('p-pass').value; }
            if(cargo === 'Secretaria') { p = document.getElementById('s-pront').value; s = document.getElementById('s-pass').value; }
            if(cargo === 'Gestão') { p = document.getElementById('g-pront').value; s = document.getElementById('g-pass').value; }
            if(cargo === 'TI') { p = document.getElementById('t-pront').value; s = document.getElementById('t-pass').value; }

            // Lógica Especial TI
            if(cargo === 'TI' && p === '123' && s === 'nti2026') {
                this.user = { nome: 'Kelvin Almeida', cargo: 'TI', pront: '123' };
                this.start();
                return;
            }

            // Login outros
            const snap = await db.ref('usuarios/' + p).once('value');
            if(snap.exists() && snap.val().pass === s && snap.val().cargo === cargo) {
                this.user = snap.val();
                this.start();
            } else {
                alert("Dados incorretos para " + cargo);
            }
        },

        start() {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('user-name').innerText = this.user.nome;
            document.getElementById('user-cargo').innerText = this.user.cargo;

            const c = this.user.cargo;
            if(c === 'Professor' || c === 'Secretaria' || c === 'TI') document.getElementById('menu-prof').classList.remove('hidden');
            if(c === 'Gestão' || c === 'TI') document.getElementById('menu-gestao').classList.remove('hidden');
            if(c === 'TI') document.getElementById('menu-ti').classList.remove('hidden');

            this.initRealtime();
        },

        view(id) {
            document.querySelectorAll('.content-view').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        },

        initRealtime() {
            // Ouvinte de Lockdown (Pânico)
            db.ref('config/lockdown').on('value', s => {
                if(s.val() && this.user.cargo !== 'TI') {
                    document.body.innerHTML = "<div style='background:red; height:100vh; display:flex; align-items:center; justify-content:center; color:white; font-family:Poppins;'><h1>SISTEMA CONGELADO PELO TI</h1></div>";
                }
            });

            // Ouvinte de Banner
            db.ref('config/banner').on('value', s => {
                const b = document.getElementById('banner-ti');
                if(s.val() && s.val().ativo) {
                    b.style.display = 'block';
                    document.getElementById('banner-text').innerText = s.val().msg;
                } else { b.style.display = 'none'; }
            });

            // Ouvinte de Atividades
            const eqs = ['TV 01', 'TV 02', 'TV 03', 'CROME 01', 'CROME 02', 'TABLETS'];
            db.ref('atividades').on('value', snap => {
                const dash = document.getElementById('dash-list');
                const grid = document.getElementById('grid-equip');
                const table = document.getElementById('table-monitor');
                dash.innerHTML = ""; grid.innerHTML = ""; table.innerHTML = "";

                let ocupados = {};
                snap.forEach(a => {
                    const d = a.val();
                    if(d.status === 'ativo') {
                        ocupados[d.equip] = true;
                        const item = `<div class="card" style="border-left: 4px solid var(--primary)"><b>${d.equip}</b> - ${d.user} na ${d.sala}</div>`;
                        dash.innerHTML += item;
                        table.innerHTML += `<tr><td>${d.user}</td><td>${d.equip}</td><td>${d.sala}</td><td>${d.hora}</td></tr>`;
                    }
                });

                eqs.forEach(e => {
                    grid.innerHTML += `<div class="login-card" style="padding:15px;">
                        <b>${e}</b><br>
                        <small style="color:${ocupados[e]?'red':'green'}">${ocupados[e]?'OCUPADO':'LIVRE'}</small>
                        ${!ocupados[e] ? `<button class="btn btn-p" style="font-size:10px" onclick="app.reservar('${e}')">PEGAR</button>`:''}
                    </div>`;
                });
            });
        },

        async reservar(eq) {
            const sala = prompt("Para qual sala?");
            if(!sala) return;
            await db.ref('atividades').push({
                equip: eq, user: this.user.nome + " (" + this.user.pront + ")",
                sala: sala, hora: new Date().toLocaleTimeString(), status: 'ativo'
            });
        },

        tiControl(tipo, val) {
            if(tipo === 'lockdown') db.ref('config/lockdown').set(val);
            if(tipo === 'banner') {
                const m = document.getElementById('ti-input-msg').value;
                db.ref('config/banner').set({ ativo: val, msg: m });
            }
        }
    };
</script>
</body>
</html>
