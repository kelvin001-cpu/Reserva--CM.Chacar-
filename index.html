<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reserva de Equipamentos - Santana de Parnaíba</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --azul-pmsp: #0056a2; --azul-claro: #00adef; }
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: url('https://images.unsplash.com/photo-1497366216548-37526070297c?q=80&w=2069&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover; min-height: 100vh; display: flex; flex-direction: column; align-items: center;
        }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 30, 60, 0.7); z-index: -1; }

        .glass-card { 
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 20px; padding: 30px;
            width: 90%; max-width: 400px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.5); margin-top: 50px;
        }

        .logo-prefeitura { width: 180px; margin-bottom: 20px; filter: drop-shadow(0px 0px 5px white); }
        
        h1 { color: white; font-size: 18px; text-transform: uppercase; margin-bottom: 25px; letter-spacing: 1px; }

        .btn-google {
            background: white; color: #444; padding: 12px 20px; border-radius: 8px; border: none;
            font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 10px;
            width: 100%; cursor: pointer; transition: 0.3s; margin-bottom: 10px;
        }
        .btn-google:hover { background: #f1f1f1; transform: scale(1.02); }

        .hidden { display: none; }

        /* Estilo dos Inputs e Seleção */
        label { display: block; text-align: left; color: white; font-size: 12px; margin: 10px 0 5px; font-weight: 600; }
        input, select { 
            width: 100%; padding: 12px; border-radius: 8px; border: none; margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.9); box-sizing: border-box;
        }

        .btn-reservar {
            background: linear-gradient(135deg, var(--azul-pmsp), var(--azul-claro));
            color: white; border: none; padding: 15px; width: 100%; border-radius: 8px;
            font-weight: bold; cursor: pointer; margin-top: 15px;
        }
    </style>
</head>
<body>

    <div id="loginSection" class="glass-card">
        <img src="https://www.santanadeparnaiba.sp.gov.br/logo_parnaiba.png" alt="Logo Santana de Parnaíba" class="logo-prefeitura">
        <h1>Sistema de Reservas</h1>
        <p style="color: white; font-size: 13px; margin-bottom: 20px;">Utilize seu e-mail institucional para acessar.</p>
        
        <button class="btn-google" onclick="loginGoogle()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20">
            Entrar com Conta Google
        </button>
    </div>

    <div id="formSection" class="glass-card hidden">
        <h2 id="welcomeMsg" style="color: white; font-size: 14px;">Olá, Professor</h2>
        <hr style="opacity: 0.2;">
        
        <label>Selecione a Turma:</label>
        <select id="turma">
            <option value="1º Ano A">1º Ano A</option>
            <option value="2º Ano A">2º Ano A</option>
            <option value="3º Ano A">3º Ano A</option>
            <option value="4º Ano A">4º Ano A</option>
            <option value="5º Ano A">5º Ano A</option>
        </select>

        <label>O que deseja reservar?</label>
        <select id="equipamento" onchange="checkEquip()">
            <option value="SALA DE INFORMÁTICA">SALA DE INFORMÁTICA</option>
            <option value="CHROMEBOOKS">CARRINHO DE CHROMEBOOKS</option>
            <option value="TV DIGITAL">TV DIGITAL</option>
        </select>

        <div id="patArea" class="hidden">
            <label>Número do Patrimônio (Apenas para TV):</label>
            <input type="text" id="patrimonio" placeholder="Ex: 230180">
        </div>

        <label>Horário Retirada:</label>
        <input type="datetime-local" id="hInicio">

        <button class="btn-reservar" onclick="salvarReserva()">CONFIRMAR RESERVA</button>
        <button onclick="logout()" style="background:none; border:none; color:white; font-size:11px; margin-top:15px; cursor:pointer; text-decoration:underline;">Sair da conta</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBoGFDKz-nBwKvczGpxg-fHJYdVykcBUQ",
            authDomain: "escala-chacara.firebaseapp.com",
            databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
            projectId: "escala-chacara",
            storageBucket: "escala-chacara.firebasestorage.app",
            messagingSenderId: "741259231706",
            appId: "1:741259231706:web:27e2b60be100e6a34180e3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        let usuarioLogado = null;

        window.loginGoogle = () => {
            signInWithPopup(auth, provider).then((result) => {
                // Login feito com sucesso
            }).catch((error) => alert("Erro ao logar: " + error.message));
        };

        window.logout = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                usuarioLogado = user;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('formSection').classList.remove('hidden');
                document.getElementById('welcomeMsg').innerText = "Bem-vindo, " + user.displayName;
            } else {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('formSection').classList.add('hidden');
            }
        });

        window.checkEquip = () => {
            const e = document.getElementById('equipamento').value;
            document.getElementById('patArea').classList.toggle('hidden', e !== 'TV DIGITAL');
        };

        window.salvarReserva = () => {
            const turma = document.getElementById('turma').value;
            const equip = document.getElementById('equipamento').value;
            const pat = document.getElementById('patrimonio').value;
            const hora = document.getElementById('hInicio').value;

            if(!hora) return alert("Selecione o horário!");

            const novaRef = push(ref(db, 'reservas'));
            set(novaRef, {
                professor: usuarioLogado.displayName,
                email: usuarioLogado.email,
                turma: turma,
                equipamento: equip,
                patrimonio: equip === 'TV DIGITAL' ? pat : "N/A",
                data: new Date(hora).toLocaleString('pt-BR')
            }).then(() => {
                alert("Reserva concluída com sucesso!");
                location.reload();
            });
        };
    </script>
</body>
</html>
