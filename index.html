<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA NTi - CONTROLE DE ATIVOS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --azul-pref: #004a99; --azul-sky: #00adef; --neon: #00ff9d;
            --nivel-1: #2ed573; --nivel-2: #ffa502; --nivel-3: #ff4757;
        }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; transition: 0.3s; }
        
        body { 
            margin: 0; background: #000b1a url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover; min-height: 100vh; display: flex; align-items: center; justify-content: center; color: white; padding: 10px;
        }

        .balao-premium {
            width: 100%; max-width: 500px; background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.25); border-radius: 30px;
            padding: 20px; box-shadow: 0 30px 60px rgba(0,0,0,0.6); text-align: center;
        }

        .hidden { display: none !important; }
        .clock-header { font-size: 12px; font-weight: 600; color: var(--azul-sky); margin-bottom: 15px; }
        
        .campo { width: 100%; height: 45px; background: white; border-radius: 12px; border: none; padding: 0 15px; font-size: 14px; color: #111; margin-bottom: 12px; font-weight: 600; }
        .btn-acao { width: 100%; height: 50px; border-radius: 15px; border: none; background: linear-gradient(135deg, var(--azul-pref), var(--azul-sky)); color: white; font-weight: 700; cursor: pointer; margin-bottom: 10px; font-size: 13px; text-transform: uppercase; }
        .btn-voltar { background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px; border-radius: 12px; width: 100%; cursor: pointer; font-size: 11px; margin-top: 10px;}

        .grid-eq { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .btn-eq { height: 45px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; font-size: 9px; font-weight: 700; cursor: pointer; }
        .btn-eq.active { background: var(--azul-sky); border-color: white; }

        .card { background: rgba(0,0,0,0.5); padding: 15px; border-radius: 15px; margin-bottom: 10px; text-align: left; border-left: 5px solid var(--neon); position: relative;}
        .card-entregue { border-left-color: #666 !important; opacity: 0.7; }
        
        .btn-baixa { background: var(--neon); color: #000; border: none; padding: 8px; border-radius: 8px; width: 100%; margin-top: 10px; font-weight: 800; cursor: pointer; font-size: 10px; }
        .btn-delete { background: var(--nivel-3); color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 9px; cursor: pointer; position: absolute; right: 10px; bottom: 10px;}
        
        .badge { font-size: 9px; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: bold; margin-bottom: 5px; display: inline-block; }
        .badge-prof { background: var(--azul-pref); }
        .badge-gestor { background: var(--nivel-2); color: black; }
        .badge-ti { background: #000; border: 1px solid var(--nivel-3); color: var(--nivel-3); }
    </style>
</head>
<body>

    <div class="balao-premium">
        <div class="clock-header" id="relogio-top">00/00/0000 00:00:00</div>

        <div id="tela-login-escolha">
            <h1>SISTEMA NTi</h1>
            <p style="font-size: 11px; opacity: 0.7; margin-bottom: 20px;">CONTROLE DE ACESSO</p>
            <button class="btn-acao" onclick="app.irPara('login-prof')">Portal Professor</button>
            <button class="btn-acao" style="background: #333;" onclick="app.irPara('login-gestor')">Portal Gestor (Monitoramento)</button>
            <button class="btn-acao" style="background: #000; border: 1px solid var(--nivel-3);" onclick="app.irPara('login-ti')">Espa√ßo TI (Master)</button>
        </div>

        <div id="tela-login-prof" class="hidden">
            <h2>PROFESSOR</h2>
            <input type="text" class="campo" id="p-nome" placeholder="Nome Completo">
            <input type="text" class="campo" id="p-id" placeholder="RP / Prontu√°rio">
            <input type="text" class="campo" id="p-mat" placeholder="Disciplina">
            <button class="btn-acao" onclick="app.auth('PROF')">ENTRAR</button>
            <button class="btn-voltar" onclick="app.irPara('login-escolha')">VOLTAR</button>
        </div>

        <div id="tela-login-gestor" class="hidden">
            <h2>GESTOR</h2>
            <input type="password" class="campo" id="pass-gestor" placeholder="Senha Gestor">
            <button class="btn-acao" onclick="app.auth('GESTOR')">ACESSAR MONITOR</button>
            <button class="btn-voltar" onclick="app.irPara('login-escolha')">VOLTAR</button>
        </div>

        <div id="tela-login-ti" class="hidden">
            <h2 style="color: var(--nivel-3);">ADMINISTRA√á√ÉO TI</h2>
            <input type="password" class="campo" id="pass-ti" placeholder="Senha TI">
            <button class="btn-acao" style="background: var(--nivel-3);" onclick="app.auth('TI')">ACESSO TOTAL</button>
            <button class="btn-voltar" onclick="app.irPara('login-escolha')">VOLTAR</button>
        </div>

        <div id="tela-menu" class="hidden">
            <span id="badge-user" class="badge"></span>
            <h3 id="txt-saudacao" style="margin-top: 5px;">Ol√°!</h3>
            
            <div id="area-reserva">
                <button class="btn-acao" onclick="app.irPara('reserva')">üìÖ NOVA RESERVA</button>
            </div>
            
            <button class="btn-acao" style="background: rgba(0,173,239,0.2);" onclick="app.abrirCronograma()">üñ•Ô∏è CRONOGRAMA DE USO</button>
            <button class="btn-acao" style="background: var(--nivel-3);" onclick="app.irPara('suporte')">üõ†Ô∏è CHAMADO SUPORTE</button>
            <button class="btn-voltar" onclick="location.reload()">SAIR</button>
        </div>

        <div id="tela-reserva" class="hidden">
            <h3>RESERVAR</h3>
            <div class="grid-eq">
                <button class="btn-eq" id="eq1" onclick="app.setEq('SALA INFO', 'eq1')">SALA INFO</button>
                <button class="btn-eq" id="eq2" onclick="app.setEq('CHROMEBOOKS', 'eq2')">CHROMEBOOKS</button>
                <button class="btn-eq" id="eq3" onclick="app.setEq('TV 01', 'eq3')">TV 01</button>
                <button class="btn-eq" id="eq4" onclick="app.setEq('TV 02', 'eq4')">TV 02</button>
                <button class="btn-eq" id="eq5" onclick="app.setEq('TV 03', 'eq5')">TV 03</button>
            </div>
            <input type="date" class="campo" id="res-data">
            <input type="time" class="campo" id="res-hora">
            <button class="btn-acao" onclick="app.salvarReserva()">CONFIRMAR</button>
            <button class="btn-voltar" onclick="app.irPara('menu')">VOLTAR</button>
        </div>

        <div id="tela-cronograma" class="hidden">
            <h3>CRONOGRAMA</h3>
            <input type="date" class="campo" id="filtro-dia" onchange="app.renderLista()">
            <div id="lista-container" style="max-height: 300px; overflow-y: auto;"></div>
            <button class="btn-voltar" onclick="app.irPara('menu')">VOLTAR</button>
        </div>

        <div id="tela-suporte" class="hidden">
            <h3>ABRIR SUPORTE</h3>
            <input type="text" class="campo" id="sup-local" placeholder="Onde est√° o erro?">
            <textarea class="campo" id="sup-obs" style="height: 70px; padding: 10px;" placeholder="Detalhes..."></textarea>
            <button class="btn-acao" style="background: var(--nivel-3);" onclick="app.enviarSuporte()">ENVIAR TI</button>
            <button class="btn-voltar" onclick="app.irPara('menu')">CANCELAR</button>
        </div>
    </div>

<script>
    // FIREBASE CONFIG
    const firebaseConfig = {
        apiKey: "AIzaSyBoGfDKz-nBwKvczzGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: { nome: "", tipo: "", rp: "" },
        tempEq: "",

        irPara(id) {
            document.querySelectorAll('.balao-premium > div').forEach(d => { if(d.id !== 'relogio-top') d.classList.add('hidden'); });
            document.getElementById('tela-' + id).classList.remove('hidden');
        },

        auth(tipo) {
            if(tipo === 'PROF') {
                const n = document.getElementById('p-nome').value;
                const r = document.getElementById('p-id').value;
                if(!n || !r) return alert("Identifique-se!");
                this.user = { nome: n.toUpperCase(), rp: r, tipo: 'PROF' };
                document.getElementById('area-reserva').classList.remove('hidden');
            } else if(tipo === 'GESTOR') {
                if(document.getElementById('pass-gestor').value !== "gestores2026") return alert("Senha Gestor Inv√°lida!");
                this.user = { nome: "GESTOR (MONITOR)", tipo: 'GESTOR' };
                document.getElementById('area-reserva').classList.add('hidden'); // Gestor n√£o reserva
            } else if(tipo === 'TI') {
                if(document.getElementById('pass-ti').value !== "nti2026") return alert("Senha TI Master Inv√°lida!");
                this.user = { nome: "ADMIN MASTER TI", tipo: 'TI' };
                document.getElementById('area-reserva').classList.add('hidden'); // TI n√£o reserva
            }

            document.getElementById('badge-user').innerText = this.user.tipo;
            document.getElementById('badge-user').className = 'badge badge-' + this.user.tipo.toLowerCase();
            document.getElementById('txt-saudacao').innerText = "Ol√°, " + this.user.nome;
            this.irPara('menu');
        },

        setEq(n, id) {
            this.tempEq = n;
            document.querySelectorAll('.btn-eq').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        },

        salvarReserva() {
            const d = document.getElementById('res-data').value;
            const h = document.getElementById('res-hora').value;
            if(!this.tempEq || !d || !h) return alert("Complete os dados!");

            db.ref('atividades').push({
                prof: this.user.nome,
                rp: this.user.rp || "N/A",
                equip: this.tempEq,
                data: d,
                hora: h,
                status: "EM USO",
                ts: Date.now()
            });
            alert("Reservado!");
            this.irPara('menu');
        },

        abrirCronograma() {
            document.getElementById('filtro-dia').valueAsDate = new Date();
            this.irPara('cronograma');
            this.renderLista();
        },

        renderLista() {
            const container = document.getElementById('lista-container');
            const filtro = document.getElementById('filtro-dia').value;
            
            db.ref('atividades').on('value', (snap) => {
                container.innerHTML = "";
                snap.forEach(item => {
                    const r = item.val();
                    const key = item.key;

                    if(r.data === filtro) {
                        const isEntregue = r.status === "ENTREGUE";
                        
                        // L√≥gica de bot√µes por n√≠vel:
                        // TI v√™ tudo (Apagar e Baixa). Professor v√™ apenas o dele (Baixa). Gestor n√£o v√™ nada.
                        const showDel = (this.user.tipo === 'TI') ? `<button class="btn-delete" onclick="app.apagar('${key}')">APAGAR</button>` : '';
                        
                        let showBaixa = '';
                        if(!isEntregue) {
                            if(this.user.tipo === 'TI' || (this.user.tipo === 'PROF' && r.prof === this.user.nome)) {
                                showBaixa = `<button class="btn-baixa" onclick="app.darBaixa('${key}')">DAR BAIXA / ENTREGAR</button>`;
                            }
                        }

                        container.innerHTML += `
                            <div class="card ${isEntregue ? 'card-entregue' : ''}">
                                <b>${r.equip}</b> <small style="float:right">${r.hora}</small><br>
                                <span style="font-size:10px">Prof: ${r.prof} | RP: ${r.rp}</span><br>
                                <span style="font-size:10px">Status: <b>${r.status}</b></span>
                                ${showBaixa}
                                ${showDel}
                            </div>
                        `;
                    }
                });
                if(!container.innerHTML) container.innerHTML = "<p style='font-size:12px; opacity:0.5'>Nenhum ativo para este dia.</p>";
            });
        },

        darBaixa(key) {
            if(confirm("Confirmar devolu√ß√£o para o sistema?")) {
                db.ref('atividades/' + key).update({ status: "ENTREGUE" });
            }
        },

        apagar(key) {
            if(confirm("TI: Excluir definitivamente este registro?")) {
                db.ref('atividades/' + key).remove();
            }
        },

        enviarSuporte() {
            const loc = document.getElementById('sup-local').value;
            const obs = document.getElementById('sup-obs').value;
            db.ref('atividades').push({
                prof: this.user.nome,
                equip: "üõ†Ô∏è SUPORTE: " + loc,
                status: "CHAMADO ABERTO",
                data: new Date().toISOString().split('T')[0],
                hora: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                obs: obs,
                ts: Date.now()
            });
            alert("Enviado ao suporte!");
            this.irPara('menu');
        }
    };

    setInterval(() => { document.getElementById('relogio-top').innerText = new Date().toLocaleString('pt-BR'); }, 1000);
</script>
</body>
</html>
