<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Kelvin Almeida</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00adef; --accent: #00ff9d; --danger: #ff4757; --warning: #ffa502;
            --glass: rgba(15, 23, 42, 0.9); --border: rgba(255, 255, 255, 0.1);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') no-repeat center center fixed;
            background-size: cover; color: white; height: 100vh; display: flex; overflow: hidden;
        }

        /* --- TELA INICIAL (WELCOME & AUTH) --- */
        #welcome-screen {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000;
            display: flex; align-items: center; justify-content: center; backdrop-filter: blur(15px);
        }
        .auth-container {
            background: var(--glass); padding: 40px; border-radius: 30px; border: 1px solid var(--border);
            width: 400px; text-align: center;
        }
        .dev-credit { font-size: 11px; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; font-weight: 700; }
        
        /* --- SIDEBAR --- */
        nav {
            width: 280px; background: rgba(0, 0, 0, 0.95); border-right: 1px solid var(--border);
            padding: 30px 20px; display: flex; flex-direction: column; gap: 8px; transition: 0.3s;
        }
        .prof-box { background: rgba(0, 173, 239, 0.1); border: 1px solid var(--primary); padding: 15px; border-radius: 15px; margin-bottom: 20px; }
        
        .nav-item {
            padding: 14px 18px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; 
            gap: 12px; color: rgba(255,255,255,0.6); transition: 0.3s; font-size: 14px;
        }
        .nav-item:hover, .nav-item.active { background: var(--primary); color: white; }

        /* --- CONTE√öDO --- */
        main { flex: 1; padding: 40px; overflow-y: auto; background: rgba(0,0,0,0.3); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: var(--glass); padding: 25px; border-radius: 20px; border: 1px solid var(--border); position: relative; }
        .badge { position: absolute; top: 15px; right: 15px; background: var(--accent); color: #000; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 800; }

        /* --- FORMUL√ÅRIO CHAMADO --- */
        .form-group { margin-bottom: 15px; text-align: left; }
        input, select, textarea { 
            width: 100%; padding: 12px; border-radius: 10px; background: rgba(0,0,0,0.5); 
            border: 1px solid #333; color: white; margin-top: 5px; box-sizing: border-box;
        }

        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-green { background: var(--accent); color: black; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <div class="auth-container">
            <div class="dev-credit">Kelvin Almeida ‚Ä¢ Dev Estagi√°rio</div>
            <h2 id="auth-title">Sistema de Reservas NTI</h2>
            <p style="font-size: 13px; opacity: 0.7; margin-bottom: 25px;">Tecnologia e agilidade para o corpo docente.</p>
            
            <div id="login-form">
                <input type="number" id="l-pront" placeholder="Prontu√°rio">
                <input type="password" id="l-pass" placeholder="Senha">
                <button class="btn btn-blue" onclick="app.login()" style="margin-top: 15px;">ENTRAR NO PORTAL</button>
                <p onclick="app.toggleAuth(true)" style="font-size: 12px; margin-top: 15px; cursor: pointer; color: var(--primary);">Novo professor? Cadastre-se aqui</p>
            </div>

            <div id="cad-form" class="hidden">
                <input type="text" id="c-nome" placeholder="Nome Completo">
                <input type="number" id="c-pront" placeholder="N√∫mero do Prontu√°rio">
                <button class="btn btn-green" onclick="app.cadastrar()" style="margin-top: 15px;">CRIAR MINHA CONTA</button>
                <p onclick="app.toggleAuth(false)" style="font-size: 12px; margin-top: 15px; cursor: pointer; color: var(--primary);">J√° tenho acesso</p>
            </div>
        </div>
    </div>

    <nav id="sidebar" class="hidden">
        <div class="prof-box">
            <small style="color:var(--primary); font-weight:700;">PROFESSOR</small>
            <div id="display-nome">Nome do Prof</div>
        </div>
        
        <div class="nav-item active" onclick="app.view('v-dash')"><i class="fa fa-th-large"></i> Dashboard</div>
        <div class="nav-item" onclick="app.view('v-chamado')"><i class="fa fa-ticket-alt"></i> Chamado NTI</div>
        <div class="nav-item" onclick="app.view('v-cron')"><i class="fa fa-calendar-alt"></i> Cronograma Real</div>
        <div class="nav-item" onclick="app.view('v-chat')"><i class="fa fa-comments"></i> Chat Escola</div>
        
        <div style="margin-top: auto; padding: 10px; border-radius: 10px; background: rgba(0,255,157,0.05); font-size: 11px;">
            <div style="display:flex; align-items:center; gap:8px;"><span style="width:8px; height:8px; background:var(--accent); border-radius:50%;"></span> <span id="online-count">1</span> Membros Online</div>
        </div>
        <div class="nav-item" style="color:var(--danger); margin-top: 10px;" onclick="location.reload()"><i class="fa fa-power-off"></i> Sair</div>
    </nav>

    <main id="main-content" class="hidden">
        
        <div id="v-dash" class="content-view">
            <h2 style="margin-bottom:30px;">Reserva de Equipamentos</h2>
            <div class="grid">
                <div class="card">
                    <div class="badge" id="u-tv1">Uso: 0</div>
                    <i class="fa fa-tv" style="font-size:30px; color:var(--primary);"></i>
                    <h3>TV SMART 01</h3>
                    <button class="btn btn-blue" onclick="app.reservar('TV SMART 01')" style="margin-top:15px;">AGENDAR</button>
                </div>
                <div class="card">
                    <div class="badge" id="u-sala">Uso: 0</div>
                    <i class="fa fa-laptop-code" style="font-size:30px; color:var(--primary);"></i>
                    <h3>SALA DE INFO</h3>
                    <button class="btn btn-blue" onclick="app.reservar('SALA DE INFO')" style="margin-top:15px;">AGENDAR</button>
                </div>
            </div>
        </div>

        <div id="v-chamado" class="content-view hidden">
            <h2>Novo Chamado NTI</h2>
            <div class="card" style="max-width: 500px;">
                <div class="form-group">
                    <label>Equipamento/Problema</label>
                    <input type="text" id="ch-assunto" placeholder="Ex: Internet lenta, Mouse quebrado">
                </div>
                <div class="form-group">
                    <label>Gravidade do Problema</label>
                    <select id="ch-gravidade">
                        <option value="Baixa">üü¢ Baixa (N√£o impede a aula)</option>
                        <option value="M√©dia">üü° M√©dia (Atrapalha a aula)</option>
                        <option value="Alta">üî¥ Alta (Impossibilita a aula)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Descri√ß√£o Detalhada</label>
                    <textarea id="ch-desc" rows="3"></textarea>
                </div>
                <button class="btn btn-green" onclick="app.enviarChamado()">ABRIR CHAMADO</button>
            </div>
        </div>

        <div id="v-cron" class="content-view hidden">
            <h2>Cronograma de Hoje</h2>
            <div id="cron-list" class="grid">
                </div>
        </div>
    </main>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null,

        toggleAuth(isCad) {
            document.getElementById('login-form').classList.toggle('hidden', isCad);
            document.getElementById('cad-form').classList.toggle('hidden', !isCad);
            document.getElementById('auth-title').innerText = isCad ? "Cadastro Docente" : "Sistema NTI";
        },

        async cadastrar() {
            const n = document.getElementById('c-nome').value;
            const p = document.getElementById('c-pront').value;
            if(!n || !p) return alert("Preencha os campos!");
            await db.ref('usuarios/'+p).set({ nome: n, pront: p, pass: 'Pmsp2026', online: false });
            alert("Cadastrado! Senha padr√£o: Pmsp2026");
            this.toggleAuth(false);
        },

        async login() {
            const p = document.getElementById('l-pront').value;
            const s = document.getElementById('l-pass').value;
            const snap = await db.ref('usuarios/'+p).once('value');
            if(snap.exists() && snap.val().pass === s) {
                this.user = snap.val();
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('sidebar').classList.remove('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                document.getElementById('display-nome').innerText = this.user.nome;
                db.ref('usuarios/'+p).update({ online: true });
                this.initData();
            } else { alert("Acesso negado!"); }
        },

        view(id) {
            document.querySelectorAll('.content-view').forEach(v => v.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        },

        async reservar(item) {
            const h = prompt("Qual o hor√°rio da reserva?");
            if(h) {
                await db.ref('atividades').push({ prof: this.user.nome, equip: item, hora: h, status: 'RESERVADO', time: Date.now() });
                alert("Reserva conclu√≠da!");
            }
        },

        async enviarChamado() {
            const ass = document.getElementById('ch-assunto').value;
            const grav = document.getElementById('ch-gravidade').value;
            const desc = document.getElementById('ch-desc').value;
            if(!ass) return alert("Informe o problema!");
            
            await db.ref('chamados').push({
                professor: this.user.nome,
                assunto: ass,
                gravidade: grav,
                descricao: desc,
                data: new Date().toLocaleString(),
                status: 'Aberto'
            });
            alert("Chamado enviado ao NTI!");
            this.view('v-dash');
        },

        initData() {
            // Monitorar Uso e Cronograma
            db.ref('atividades').on('value', snap => {
                const list = document.getElementById('cron-list');
                list.innerHTML = "";
                let u1 = 0, u2 = 0;
                snap.forEach(a => {
                    const d = a.val();
                    if(d.equip === 'TV SMART 01') u1++;
                    if(d.equip === 'SALA DE INFO') u2++;
                    list.innerHTML += `<div class="card"><b>${d.equip}</b><br><small>Prof: ${d.prof}</small><br><span>${d.hora}</span></div>`;
                });
                document.getElementById('u-tv1').innerText = "Uso: " + u1;
                document.getElementById('u-sala').innerText = "Uso: " + u2;
            });

            // Monitorar Online
            db.ref('usuarios').on('value', snap => {
                let on = 0;
                snap.forEach(u => { if(u.val().online) on++; });
                document.getElementById('online-count').innerText = on;
            });
        }
    };
</script>
</body>
</html>
