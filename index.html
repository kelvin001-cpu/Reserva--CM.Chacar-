<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Kelvin Almeida</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00adef; --accent: #00ff9d; --danger: #ff4757;
            --dark: #020617; --glass: rgba(15, 23, 42, 0.95);
        }

        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* BANNER DE AVISO */
        .banner-top { background: var(--danger); padding: 12px; text-align: center; font-weight: bold; font-size: 14px; display: none; border-bottom: 2px solid rgba(0,0,0,0.2); }

        /* LOGIN */
        #screen-auth { position: fixed; inset: 0; background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') center/cover; z-index: 5000; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        .portal-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; width: 95%; max-width: 1200px; padding: 40px 0; }
        .card-login { background: var(--glass); padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; backdrop-filter: blur(10px); }

        /* LAYOUT */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        nav { width: 250px; background: #000; border-right: 1px solid #1e293b; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .nav-link { padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: #94a3b8; transition: 0.3s; }
        .nav-link.active { background: var(--primary); color: white; }
        main { flex: 1; padding: 25px; overflow-y: auto; background: #0f172a; }
        .content-card { background: var(--glass); padding: 20px; border-radius: 15px; border: 1px solid #1e293b; margin-bottom: 20px; }

        /* TABELAS */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #1e293b; font-size: 13px; }
        .btn-sm { padding: 6px 10px; font-size: 11px; border-radius: 5px; cursor: pointer; border: none; font-weight: bold; margin-right: 5px; }

        input, select, textarea { width: 100%; padding: 12px; margin-top: 8px; border-radius: 8px; border: 1px solid #334155; background: #020617; color: white; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .hidden { display: none !important; }
        
        .footer-credits { position: fixed; bottom: 10px; right: 20px; font-size: 11px; color: var(--primary); background: rgba(0,0,0,0.6); padding: 4px 8px; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="ti-alert" class="banner-top"><i class="fa fa-triangle-exclamation"></i> AVISO NTI: <span id="ti-alert-msg"></span></div>

    <div id="screen-auth">
        <h1 style="color: var(--primary); margin-top: 50px; letter-spacing: 2px;">SISTEMA NTI</h1>
        <div class="portal-container">
            <div class="card-login"><i class="fa fa-chalkboard-user fa-2x"></i><h2>PROFESSOR</h2><input type="number" id="p-pront" placeholder="Prontuário"><input type="password" id="p-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Professor')">ENTRAR</button><button class="btn" style="background:transparent; font-size:11px" onclick="app.abrirCad('Professor')">Novo Professor? Cadastre-se</button></div>
            
            <div class="card-login"><i class="fa fa-building-user fa-2x"></i><h2>SECRETARIA</h2><input type="number" id="s-pront" placeholder="Prontuário"><input type="password" id="s-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Secretaria')">ENTRAR</button><button class="btn" style="background:transparent; font-size:11px" onclick="app.abrirCad('Secretaria')">Nova Secretaria? Cadastre-se</button></div>
            
            <div class="card-login"><i class="fa fa-user-tie fa-2x"></i><h2>GESTÃO</h2><input type="number" id="g-pront" placeholder="Prontuário"><input type="password" id="g-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Gestão')">ENTRAR</button><button class="btn" style="background:transparent; font-size:11px" onclick="app.abrirCad('Gestão')">Nova Gestão? Cadastre-se</button></div>
            
            <div class="card-login" style="border: 2px solid var(--accent)"><i class="fa fa-code fa-2x" style="color: var(--accent)"></i><h2 style="color: var(--accent)">TI MASTER</h2><input type="number" id="t-pront" placeholder="Prontuário Kelvin"><input type="password" id="t-pass" placeholder="Senha"><button class="btn" style="background: var(--accent); color: #000;" onclick="app.login('TI')">TERMINAL MASTER</button></div>
        </div>
    </div>

    <div class="main-layout">
        <nav id="sidebar" class="hidden">
            <div style="text-align: center; margin-bottom: 20px; border-bottom: 1px solid #1e293b; padding-bottom: 10px;">
                <b id="user-display"></b><br><small id="cargo-display" style="color: var(--primary)"></small>
            </div>
            <div class="nav-link active" onclick="app.view('v-dash')"><i class="fa fa-home"></i> Início</div>
            <div class="nav-link" onclick="app.view('v-chat')"><i class="fa fa-comments"></i> Chat Escola</div>
            <div class="nav-link" onclick="app.view('v-chamado')"><i class="fa fa-headset"></i> Chamado NTI</div>
            <div id="m-servicos" class="hidden"><div class="nav-link" onclick="app.view('v-reservar')"><i class="fa fa-laptop"></i> Reservar Item</div></div>
            <div id="m-gestao" class="hidden"><div class="nav-link" onclick="app.view('v-monitor')"><i class="fa fa-chart-line"></i> Monitoramento</div></div>
            <div id="m-ti" class="hidden"><div class="nav-link" style="color: var(--accent)" onclick="app.view('v-ti-master')"><i class="fa fa-shield"></i> PAINEL TI</div></div>
            <button class="btn btn-danger" style="margin-top:auto" onclick="location.reload()">SAIR</button>
        </nav>

        <main id="app-main" class="hidden">
            <div id="v-dash" class="view"><h2>Status dos Equipamentos</h2><div id="lista-atividades"></div></div>
            <div id="v-reservar" class="view hidden"><h3>Equipamentos Disponíveis</h3><div id="grid-itens" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px;"></div></div>
            <div id="v-chat" class="view hidden"><h3>Chat Escola</h3><div id="chat-box" style="height:400px; background:#020617; border-radius:10px; padding:15px; display:flex; flex-direction:column;"><div id="chat-msgs" style="flex:1; overflow-y:auto"></div><div style="display:flex; gap:10px; margin-top:10px"><input type="text" id="chat-in" placeholder="Escreva aqui..."><button class="btn btn-blue" style="width:100px; margin:0" onclick="app.chatSend()">OK</button></div></div></div>
            
            <div id="v-ti-master" class="view hidden">
                <h2 style="color: var(--accent)">Terminal Master TI</h2>
                <div class="content-card">
                    <h4>Avisos e Sistema</h4>
                    <div style="display:flex; gap:10px">
                        <input type="text" id="ti-msg-in" placeholder="Texto do banner de aviso...">
                        <button class="btn btn-blue" style="width:150px; margin:0" onclick="app.tiCmd('banner', true)">POSTAR</button>
                        <button class="btn btn-danger" style="width:100px; margin:0" onclick="app.tiCmd('banner', false)">REMOVER</button>
                    </div>
                </div>

                <h3>Gerenciamento de Usuários</h3>
                <div class="content-card">
                    <table>
                        <thead><tr><th>Nome</th><th>Pront.</th><th>Cargo</th><th>Status</th><th>Controle</th><th>Senha</th></tr></thead>
                        <tbody id="ti-user-list"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-cad" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:6000; display:flex; align-items:center; justify-content:center;">
        <div class="card-login" style="width:340px">
            <h2 id="cad-title">Cadastro</h2>
            <input type="text" id="c-nome" placeholder="Nome Completo">
            <input type="number" id="c-pront" placeholder="Prontuário">
            <button class="btn btn-blue" onclick="app.confirmarCad()">CRIAR CONTA</button>
            <button class="btn" onclick="document.getElementById('modal-cad').classList.add('hidden')">CANCELAR</button>
        </div>
    </div>

    <div class="footer-credits">Kelvin Almeida - Estagiário NTI - Programa Conect</div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null, portalCad: '',
        abrirCad(p) { this.portalCad = p; document.getElementById('cad-title').innerText = "Novo " + p; document.getElementById('modal-cad').classList.remove('hidden'); },
        async confirmarCad() {
            const n = document.getElementById('c-nome').value, p = document.getElementById('c-pront').value;
            if(!n || !p) return alert("Preencha tudo!");
            let s = (this.portalCad==='Gestão')?'gestao2026':(this.portalCad==='Secretaria')?'secretaria2026':'pmsp2026';
            await db.ref('usuarios/'+p).set({ nome: n, pront: p, cargo: this.portalCad, pass: s, status: 'ativo' });
            alert("Sucesso! Senha inicial: " + s);
            document.getElementById('modal-cad').classList.add('hidden');
        },
        async login(portal) {
            let p = document.getElementById(portal==='Professor'?'p-pront':portal==='Secretaria'?'s-pront':portal==='Gestão'?'g-pront':'t-pront').value;
            let s = document.getElementById(portal==='Professor'?'p-pass':portal==='Secretaria'?'s-pass':portal==='Gestão'?'g-pass':'t-pass').value;

            if(portal === 'TI' && p === '46690' && s === 'nti2026') { 
                this.user = { nome: 'Kelvin Master', cargo: 'TI', pront: '46690' }; return this.iniciar(); 
            }

            const snap = await db.ref('usuarios/'+p).once('value');
            if(snap.exists()){
                const u = snap.val();
                if(u.status === 'bloqueado') return alert("VOCÊ FOI BLOQUEADO PELO TI.");
                if(u.pass === s && u.cargo === portal) { this.user = u; this.iniciar(); }
                else alert("Senha ou Portal Incorreto!");
            } else alert("Usuário não cadastrado!");
        },
        iniciar() {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('user-display').innerText = this.user.nome;
            document.getElementById('cargo-display').innerText = this.user.cargo;
            if(this.user.cargo !== 'Gestão') document.getElementById('m-servicos').classList.remove('hidden');
            if(this.user.cargo === 'Gestão' || this.user.cargo === 'TI') document.getElementById('m-gestao').classList.remove('hidden');
            if(this.user.cargo === 'TI') document.getElementById('m-ti').classList.remove('hidden');
            this.sync();
        },
        view(id) { document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); },
        sync() {
            // Monitor de Avisos
            db.ref('config/banner').on('value', s => {
                const box = document.getElementById('ti-alert');
                if(s.val() && s.val().ativo) { box.style.display = 'block'; document.getElementById('ti-alert-msg').innerText = s.val().msg; }
                else box.style.display = 'none';
            });
            
            // Atividades
            db.ref('atividades').on('value', snap => {
                const list = document.getElementById('lista-atividades'); list.innerHTML = "";
                snap.forEach(a => { const d = a.val(); list.innerHTML += `<div class="content-card"><b>${d.item}</b> - Em uso por ${d.user} na ${d.sala} ${this.user.cargo==='TI'?'<button class="btn-sm btn-danger" onclick="app.remover(\'atividades/'+a.key+'\')">BAIXA</button>':''}</div>`; });
            });

            // Lista de Usuários (Painel TI)
            if(this.user.cargo === 'TI') {
                db.ref('usuarios').on('value', snap => {
                    const tb = document.getElementById('ti-user-list'); tb.innerHTML = "";
                    snap.forEach(u => {
                        const d = u.val();
                        tb.innerHTML += `<tr><td>${d.nome}</td><td>${d.pront}</td><td>${d.cargo}</td><td>${d.status}</td>
                        <td>
                            <button class="btn-sm btn-danger" onclick="app.userCmd('${d.pront}','status','bloqueado')">BLOQUEAR</button>
                            <button class="btn-sm" style="background:green;color:white" onclick="app.userCmd('${d.pront}','status','ativo')">ATIVAR</button>
                        </td>
                        <td><button class="btn-sm btn-blue" onclick="app.userCmd('${d.pront}','pass','${d.cargo==='Gestão'?'gestao2026':d.cargo==='Secretaria'?'secretaria2026':'pmsp2026'}')">RESET SENHA</button></td>
                        </tr>`;
                    });
                });
            }
        },
        remover(path) { if(confirm("Deseja dar baixa?")) db.ref(path).remove(); },
        userCmd(p, campo, valor) { db.ref('usuarios/'+p).update({ [campo]: valor }); alert("Ação realizada!"); },
        tiCmd(cmd, v) { 
            if(cmd === 'banner') db.ref('config/banner').set({ ativo: v, msg: document.getElementById('ti-msg-in').value });
        },
        chatSend() { const i = document.getElementById('chat-in'); if(i.value) { db.ref('chat').push({ user: this.user.nome, text: i.value }); i.value = ""; } }
    };
</script>
</body>
</html>
