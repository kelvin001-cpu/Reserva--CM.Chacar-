<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Portal Professor</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --blue: #00adef; --green: #00ff9d; --red: #ff4757; --dark-bg: #010409; --card-bg: rgba(13, 17, 23, 0.95); }
        
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: var(--dark-bg) url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') no-repeat center center fixed; 
            background-size: cover; color: white; min-height: 100vh; padding: 20px;
        }

        /* Topo */
        .header-main { width: 100%; max-width: 1200px; margin: 0 auto 20px auto; display: flex; justify-content: space-between; align-items: center; }
        .header-main h1 { font-size: 18px; letter-spacing: 2px; color: var(--blue); margin:0; }

        /* Grid Principal */
        .container { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 25px; 
            max-width: 1200px; 
            margin: 0 auto;
        }

        .card-box { 
            background: var(--card-bg); 
            border: 1px solid rgba(255,255,255,0.1); 
            border-radius: 24px; 
            padding: 25px; 
            backdrop-filter: blur(10px);
        }

        h3 { margin-top: 0; font-weight: 600; font-size: 16px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; color: var(--blue); }

        /* --- SE√á√ÉO RESERVAS --- */
        .list-equip { display: flex; flex-direction: column; gap: 12px; margin-top: 15px; }
        .row-equip { 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);
        }
        .row-equip b { font-size: 14px; }
        .btn-reserva { background: var(--blue); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 12px; }

        /* --- SE√á√ÉO CHAMADOS --- */
        .flex-form { display: flex; flex-direction: column; gap: 10px; }
        select, textarea, input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3); color: white; font-family: inherit; }
        .btn-chamado { background: var(--red); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* --- SE√á√ÉO CRONOGRAMA & CHAT --- */
        .live-feed { height: 180px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 12px; padding: 10px; font-size: 13px; margin-bottom: 15px; }
        .log-item { padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-item b { color: var(--green); }

        .chat-area { height: 120px; overflow-y: auto; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 12px; margin-bottom: 10px; font-size: 12px; }
        
        .footer-nti { position: fixed; bottom: 15px; right: 25px; font-size: 11px; color: rgba(255,255,255,0.3); text-align: right; }
        .hidden { display: none !important; }

        /* Layout Responsivo */
        @media (max-width: 800px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body onload="app.init()">

    <div class="header-main">
        <h1>SISTEMA NTI</h1>
        <div id="prof-tag" style="font-weight: bold; font-size: 13px;">Acesso Restrito</div>
    </div>

    <div id="auth-screen" style="max-width: 400px; margin: 100px auto;" class="card-box">
        <h3>Identifica√ß√£o do Professor</h3>
        <input type="number" id="in-pront" placeholder="Digite seu Prontu√°rio" oninput="app.verificar(this.value)">
        <div id="cad-box" class="hidden">
            <input type="text" id="in-nome" placeholder="Seu Nome Completo">
            <input type="text" id="in-materia" placeholder="Sua Disciplina">
        </div>
        <input type="password" id="in-pass" placeholder="Sua Senha" style="margin-top: 10px;">
        <button class="btn-reserva" style="width:100%; margin-top:15px; padding:15px;" onclick="app.logar()">ENTRAR</button>
    </div>

    <div id="dash-screen" class="container hidden">
        
        <div class="card-box">
            <h3>üìÖ RESERVA DE EQUIPAMENTOS</h3>
            <div class="list-equip">
                <div class="row-equip">
                    <span>üì∫ <b>TV SMART 01</b></span>
                    <button class="btn-reserva" onclick="app.reservar('TV 01')">Agendar</button>
                </div>
                <div class="row-equip">
                    <span>üì∫ <b>TV SMART 02</b></span>
                    <button class="btn-reserva" onclick="app.reservar('TV 02')">Agendar</button>
                </div>
                <div class="row-equip">
                    <span>üì∫ <b>TV SMART 03</b></span>
                    <button class="btn-reserva" onclick="app.reservar('TV 03')">Agendar</button>
                </div>
                <div class="row-equip">
                    <span>üíª <b>CARRINHO CHROMEBOOK</b></span>
                    <button class="btn-reserva" onclick="app.reservar('Chromebooks')">Agendar</button>
                </div>
                <div class="row-equip">
                    <span>üñ•Ô∏è <b>SALA DE INFORM√ÅTICA</b></span>
                    <button class="btn-reserva" onclick="app.reservar('Sala Info')">Agendar</button>
                </div>
            </div>
        </div>

        <div class="column-right">
            
            <div class="card-box" style="margin-bottom: 25px;">
                <h3>üÜò CHAMADO T√âCNICO NTI</h3>
                <div class="flex-form">
                    <select id="gravidade">
                        <option value="Baixa">üü¢ Gravidade: Baixa (D√∫vida/Ajuste)</option>
                        <option value="M√©dia">üü° Gravidade: M√©dia (Lento/Travando)</option>
                        <option value="Alta">üî¥ Gravidade: Alta (N√£o liga/Parado)</option>
                    </select>
                    <textarea id="relato" rows="2" placeholder="O que aconteceu?"></textarea>
                    <button class="btn-chamado" onclick="app.enviarChamado()">ABRIR CHAMADO</button>
                </div>
            </div>

            <div class="card-box">
                <h3>üïí CRONOGRAMA LIVE & CHAT</h3>
                <div id="live-feed" class="live-feed">
                    </div>
                <div class="chat-area" id="chat-msg"></div>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="chat-in" placeholder="D√∫vida r√°pida...">
                    <button class="btn-reserva" onclick="app.sendChat()">OK</button>
                </div>
            </div>

        </div>

    </div>

    <div class="footer-nti">
        Feito pelo estagi√°rio <b>Kelvin</b><br>
        Programa <b>Conect NTI</b>
    </div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null, existe: false,

        async verificar(p) {
            if(p.length < 3) return;
            const snap = await db.ref(`usuarios/professores/${p}`).once('value');
            this.existe = snap.exists();
            document.getElementById('cad-box').classList.toggle('hidden', this.existe);
        },

        async logar() {
            const p = document.getElementById('in-pront').value;
            const s = document.getElementById('in-pass').value;
            if(this.existe) {
                const snap = await db.ref(`usuarios/professores/${p}`).once('value');
                if(snap.val().pass === s) this.iniciar(snap.val()); else alert("Senha incorreta");
            } else {
                const n = document.getElementById('in-nome').value;
                const m = document.getElementById('in-materia').value;
                if(!n || !s) return alert("Complete o cadastro");
                const u = { nome: n, materia: m, pront: p, pass: s };
                await db.ref(`usuarios/professores/${p}`).set(u);
                this.iniciar(u);
            }
        },

        iniciar(user) {
            this.user = user;
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('dash-screen').classList.remove('hidden');
            document.getElementById('prof-tag').innerText = "PROF. " + user.nome.toUpperCase();
            this.carregarDados();
        },

        reservar(item) {
            const aula = prompt(`Para qual aula voc√™ quer a ${item}?`);
            if(aula) db.ref('reservas').push({ prof: this.user.nome, item, aula });
        },

        enviarChamado() {
            const g = document.getElementById('gravidade').value;
            const r = document.getElementById('relato').value;
            if(r) {
                db.ref('chamados').push({ prof: this.user.nome, g, r, status: 'Aberto' });
                alert("Chamado enviado ao NTI!");
                document.getElementById('relato').value = "";
            }
        },

        sendChat() {
            const m = document.getElementById('chat-in').value;
            if(m) {
                db.ref('chat').push({ nome: this.user.nome, m });
                document.getElementById('chat-in').value = "";
            }
        },

        carregarDados() {
            db.ref('reservas').on('value', snap => {
                const feed = document.getElementById('live-feed');
                feed.innerHTML = "";
                snap.forEach(d => {
                    feed.innerHTML += `<div class="log-item"><b>${d.val().prof}</b> reservou <b>${d.val().item}</b> (${d.val().aula})</div>`;
                });
                feed.scrollTop = feed.scrollHeight;
            });

            db.ref('chat').on('value', snap => {
                const box = document.getElementById('chat-msg');
                box.innerHTML = "";
                snap.forEach(d => {
                    box.innerHTML += `<div><b>${d.val().nome}:</b> ${d.val().m}</div>`;
                });
                box.scrollTop = box.scrollHeight;
            });
        }
    };
</script>
</body>
</html>
