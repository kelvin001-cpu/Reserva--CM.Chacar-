<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Kelvin Almeida</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00adef; --accent: #00ff9d; --danger: #ff4757;
            --dark: #020617; --glass: rgba(15, 23, 42, 0.95);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* INTRO E CRÉDITOS */
        .intro-text {
            background: var(--glass); padding: 25px; border-radius: 20px;
            border: 1px solid var(--primary); margin: 20px auto; max-width: 800px;
            text-align: center; font-size: 14px; line-height: 1.6;
        }

        .footer-credits {
            position: fixed; bottom: 10px; right: 20px; font-size: 12px;
            color: var(--primary); text-align: right; z-index: 1000;
            background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px;
        }

        /* LOGIN */
        #screen-auth {
            position: fixed; inset: 0; background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') center/cover;
            z-index: 5000; display: flex; flex-direction: column; align-items: center; overflow-y: auto;
        }

        .portal-container {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px; width: 90%; max-width: 1200px; padding-bottom: 50px;
        }

        .card-login {
            background: var(--glass); padding: 20px; border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
        }

        /* LAYOUT INTERNO */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        nav { width: 250px; background: #000; border-right: 1px solid #1e293b; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .nav-link { padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: #94a3b8; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { background: var(--primary); color: white; }
        main { flex: 1; padding: 25px; overflow-y: auto; }
        .content-card { background: var(--glass); padding: 20px; border-radius: 15px; border: 1px solid #1e293b; margin-bottom: 20px; }

        /* CHAT */
        #chat-container { height: 400px; display: flex; flex-direction: column; background: rgba(0,0,0,0.3); border-radius: 15px; padding: 15px; border: 1px solid #1e293b; }
        #chat-messages { flex: 1; overflow-y: auto; margin-bottom: 10px; display: flex; flex-direction: column; gap: 8px; }
        .msg { background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 10px; font-size: 13px; }
        .msg b { color: var(--primary); }

        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .hidden { display: none !important; }
        .banner-top { background: var(--danger); padding: 10px; text-align: center; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="ti-alert" class="banner-top">AVISO: <span id="ti-alert-msg"></span></div>

    <div id="screen-auth">
        <h1 style="color: var(--primary); margin-top: 40px; font-size: 40px;">SISTEMA NTI</h1>
        <div class="intro-text">
            Este sistema foi desenvolvido para facilitar a gestão de professores e gestores, 
            otimizando o controle de equipamentos e elevando o progresso da tecnologia na educação, 
            preparando nossas escolas para o futuro da inovação.
        </div>
        <div class="portal-container">
            <div class="card-login"><i class="fa fa-chalkboard-user"></i><h2>PROFESSOR</h2><input type="number" id="p-pront" placeholder="Prontuário"><input type="password" id="p-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Professor')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Professor')">Criar Conta</button></div>
            <div class="card-login"><i class="fa fa-building-user"></i><h2>SECRETARIA</h2><input type="number" id="s-pront" placeholder="Prontuário"><input type="password" id="s-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Secretaria')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Secretaria')">Criar Conta</button></div>
            <div class="card-login"><i class="fa fa-user-tie"></i><h2>GESTÃO</h2><input type="number" id="g-pront" placeholder="Prontuário"><input type="password" id="g-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Gestão')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Gestão')">Criar Conta</button></div>
            <div class="card-login" style="border: 2px solid var(--accent)"><i class="fa fa-code-branch" style="color: var(--accent)"></i><h2 style="color: var(--accent)">TI MASTER</h2><input type="number" id="t-pront" placeholder="ID Kelvin"><input type="password" id="t-pass" placeholder="Senha Master"><button class="btn" style="background: var(--accent); color: #000;" onclick="app.login('TI')">ENTRAR NO TERMINAL</button></div>
        </div>
    </div>

    <div class="main-layout">
        <nav id="sidebar" class="hidden">
            <div style="text-align: center; border-bottom: 1px solid #1e293b; padding-bottom: 15px; margin-bottom: 15px;"><b id="user-display"></b><br><small id="cargo-display" style="opacity:0.6"></small></div>
            <div class="nav-link active" onclick="app.view('v-dash')"><i class="fa fa-home"></i> Início</div>
            <div class="nav-link" onclick="app.view('v-chat')"><i class="fa fa-comments"></i> Chat Escola</div>
            <div class="nav-link" onclick="app.view('v-chamado')"><i class="fa fa-headset"></i> Chamado NTI</div>
            <div id="m-servicos" class="hidden"><div class="nav-link" onclick="app.view('v-reservar')"><i class="fa fa-calendar-check"></i> Reservar Item</div></div>
            <div id="m-gestao" class="hidden"><div class="nav-link" onclick="app.view('v-monitor')"><i class="fa fa-desktop"></i> Monitoramento</div></div>
            <div id="m-ti" class="hidden"><div class="nav-link" style="color: var(--accent)" onclick="app.view('v-ti-master')"><i class="fa fa-terminal"></i> PAINEL TI</div></div>
            <button class="btn btn-danger" style="margin-top:auto" onclick="location.reload()">SAIR</button>
        </nav>

        <main id="app-main" class="hidden">
            <div id="v-dash" class="view"><h2>Painel de Atividades</h2><div id="lista-atividades">Nenhum item em uso.</div></div>
            <div id="v-reservar" class="view hidden"><h3>Equipamentos</h3><div id="grid-itens" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px;"></div></div>
            
            <div id="v-chat" class="view hidden">
                <h3>Chat Global Aberto</h3>
                <div id="chat-container">
                    <div id="chat-messages"></div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="chat-input" placeholder="Digite sua mensagem...">
                        <button class="btn btn-blue" style="width: 100px; margin: 0;" onclick="app.sendChat()">ENVIAR</button>
                    </div>
                </div>
            </div>

            <div id="v-chamado" class="view hidden">
                <h3>Abrir Chamado para o TI</h3>
                <div class="content-card" style="max-width: 500px;">
                    <label>Tipo de Problema</label>
                    <select id="ch-tipo"><option>Internet / Rede</option><option>Projetor / TV</option><option>Computador / Note</option><option>Software / Senhas</option></select>
                    <label>Descrição</label><textarea id="ch-desc" rows="4" placeholder="Detalhe o erro..."></textarea>
                    <button class="btn btn-blue" onclick="app.enviarChamado()">ENVIAR AO KELVIN</button>
                </div>
            </div>

            <div id="v-monitor" class="view hidden"><h3>Monitor Geral</h3><div class="content-card"><table style="width:100%; text-align:left;"><thead><tr><th>Quem</th><th>O quê</th><th>Local</th><th>Início</th></tr></thead><tbody id="tab-monitor"></tbody></table></div></div>

            <div id="v-ti-master" class="view hidden">
                <h2 style="color: var(--accent)">Terminal Master TI</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="content-card"><h4>Sistema</h4><button class="btn btn-danger" onclick="app.tiCmd('lock', true)">CONGELAR SITE</button><button class="btn" style="background: green; color:white;" onclick="app.tiCmd('lock', false)">LIBERAR SITE</button></div>
                    <div class="content-card"><h4>Aviso</h4><input type="text" id="ti-msg" placeholder="Texto do banner..."><button class="btn btn-blue" onclick="app.tiCmd('banner', true)">POSTAR</button></div>
                </div>
                <h3>Chamados em Aberto</h3><div id="ti-chamados-list"></div>
            </div>
        </main>
    </div>

    <div id="modal-cad" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:6000; display:flex; align-items:center; justify-content:center;">
        <div class="card-login" style="width:340px">
            <h2 id="cad-nome-portal">Cadastro</h2>
            <input type="text" id="c-nome" placeholder="Nome Completo">
            <input type="number" id="c-pront-new" placeholder="Prontuário">
            <p id="info-senha" style="font-size: 11px; color: var(--primary);"></p>
            <button class="btn btn-blue" onclick="app.confirmarCad()">CRIAR CONTA</button>
            <button class="btn" onclick="document.getElementById('modal-cad').classList.add('hidden')">VOLTAR</button>
        </div>
    </div>

    <div class="footer-credits">Kelvin Almeida estagiário do programa conect desenvolveu sistema NTI</div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null, tempPortal: '',

        abrirCad(p) { 
            this.tempPortal = p; 
            document.getElementById('cad-nome-portal').innerText = "Novo " + p;
            let senhaP = (p === 'Professor') ? 'pmsp2026' : (p === 'Gestão') ? 'gestao2026' : 'secretaria2026';
            document.getElementById('info-senha').innerText = "A senha padrão será: " + senhaP;
            document.getElementById('modal-cad').classList.remove('hidden'); 
        },

        async confirmarCad() {
            const n = document.getElementById('c-nome').value;
            const p = document.getElementById('c-pront-new').value;
            if(!n || !p) return alert("Preencha Nome e Prontuário!");
            
            // Define senha com base no portal
            let senhaDefinida = 'pmsp2026'; // padrão prof
            if(this.tempPortal === 'Gestão') senhaDefinida = 'gestao2026';
            if(this.tempPortal === 'Secretaria') senhaDefinida = 'secretaria2026';

            try {
                await db.ref('usuarios/' + p).set({
                    nome: n, pront: p, cargo: this.tempPortal,
                    pass: senhaDefinida, status: 'ativo'
                });
                alert("Cadastrado! Senha de acesso: " + senhaDefinida);
                document.getElementById('modal-cad').classList.add('hidden');
                document.getElementById('c-nome').value = ""; document.getElementById('c-pront-new').value = "";
            } catch (e) { alert("Erro ao salvar."); }
        },

        async login(portal) {
            let p, s;
            if(portal === 'Professor') { p = document.getElementById('p-pront').value; s = document.getElementById('p-pass').value; }
            if(portal === 'Secretaria') { p = document.getElementById('s-pront').value; s = document.getElementById('s-pass').value; }
            if(portal === 'Gestão') { p = document.getElementById('g-pront').value; s = document.getElementById('g-pass').value; }
            if(portal === 'TI') { p = document.getElementById('t-pront').value; s = document.getElementById('t-pass').value; }

            // LOGIN KELVIN TI
            if(portal === 'TI' && p === '123' && s === 'nti2026') { 
                this.user = { nome: 'Kelvin Almeida', cargo: 'TI', pront: '123' }; 
                return this.iniciar(); 
            }

            const snap = await db.ref('usuarios/'+p).once('value');
            if(snap.exists() && snap.val().pass === s && snap.val().cargo === portal) { 
                this.user = snap.val(); 
                this.iniciar(); 
            } else {
                alert("Acesso negado. Verifique o Prontuário e a Senha padrão para o portal " + portal);
            }
        },

        iniciar() {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('user-display').innerText = this.user.nome;
            document.getElementById('cargo-display').innerText = this.user.cargo;

            if(this.user.cargo === 'Professor' || this.user.cargo === 'Secretaria' || this.user.cargo === 'TI') document.getElementById('m-servicos').classList.remove('hidden');
            if(this.user.cargo === 'Gestão' || this.user.cargo === 'TI') document.getElementById('m-gestao').classList.remove('hidden');
            if(this.user.cargo === 'TI') document.getElementById('m-ti').classList.remove('hidden');

            this.sync();
        },

        view(id) { 
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); 
            document.getElementById(id).classList.remove('hidden'); 
        },

        sync() {
            db.ref('config/lock').on('value', s => { if(s.val() && this.user.cargo !== 'TI') document.body.innerHTML = "<h1 style='color:white; text-align:center; margin-top:100px;'>SISTEMA EM MANUTENÇÃO PELO TI</h1>"; });
            db.ref('config/banner').on('value', s => { const b = document.getElementById('ti-alert'); if(s.val() && s.val().ativo) { b.style.display = 'block'; document.getElementById('ti-alert-msg').innerText = s.val().msg; } else b.style.display = 'none'; });
            
            const itens = ['TV 01', 'TV 02', 'TV 03', 'CROME 01', 'CROME 02', 'TABLETS'];
            db.ref('atividades').on('value', snap => {
                const list = document.getElementById('lista-atividades'), grid = document.getElementById('grid-itens'), tab = document.getElementById('tab-monitor');
                list.innerHTML = ""; grid.innerHTML = ""; tab.innerHTML = ""; let ocupados = {};
                snap.forEach(a => { const d = a.val(); if(d.status === 'ativo') { ocupados[d.item] = true; list.innerHTML += `<div class="content-card"><b>${d.item}</b> - ${d.user} na ${d.sala}</div>`; tab.innerHTML += `<tr><td>${d.user}</td><td>${d.item}</td><td>${d.sala}</td><td>${d.hora}</td></tr>`; } });
                itens.forEach(i => { grid.innerHTML += `<div class="card-login" style="padding:10px"><b>${i}</b><br><small style="color:${ocupados[i]?'red':'green'}">${ocupados[i]?'EM USO':'LIVRE'}</small>${!ocupados[i]?`<button class="btn btn-blue" style="font-size:10px" onclick="app.reservar('${i}')">PEGAR</button>`:''}</div>`; });
            });

            db.ref('chamados').on('value', snap => {
                const tiList = document.getElementById('ti-chamados-list');
                if(tiList) { tiList.innerHTML = ""; snap.forEach(c => { const d = c.val(); tiList.innerHTML += `<div class="content-card"><b>${d.tipo}</b> de ${d.user} (${d.cargo})<br><p>${d.desc}</p><button class="btn btn-danger" onclick="app.removerChamado('${c.key}')">CONCLUIR</button></div>`; }); }
            });

            db.ref('chat').limitToLast(20).on('value', snap => {
                const chatBox = document.getElementById('chat-messages'); chatBox.innerHTML = "";
                snap.forEach(m => { const d = m.val(); chatBox.innerHTML += `<div class="msg"><b>${d.user}:</b> ${d.text}</div>`; });
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        },

        async reservar(item) { const sala = prompt("Para qual sala?"); if(!sala) return; await db.ref('atividades').push({ item, user: this.user.nome, sala, hora: new Date().toLocaleTimeString(), status: 'ativo' }); },
        
        async enviarChamado() {
            const t = document.getElementById('ch-tipo').value, d = document.getElementById('ch-desc').value;
            if(!d) return alert("Descreva o problema!");
            await db.ref('chamados').push({ tipo: t, desc: d, user: this.user.nome, cargo: this.user.cargo, status: 'pendente' });
            alert("Chamado enviado ao Kelvin!"); document.getElementById('ch-desc').value = ""; this.view('v-dash');
        },

        removerChamado(key) { db.ref('chamados/'+key).remove(); },

        sendChat() {
            const input = document.getElementById('chat-input');
            if(input.value) { db.ref('chat').push({ user: this.user.nome, text: input.value }); input.value = ""; }
        },

        tiCmd(cmd, val) {
            if(cmd === 'lock') db.ref('config/lock').set(val);
            if(cmd === 'banner') db.ref('config/banner').set({ ativo: val, msg: document.getElementById('ti-msg').value });
        }
    };
</script>
</body>
</html>
