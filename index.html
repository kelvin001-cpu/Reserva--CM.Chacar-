<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal CM Ch√°cara das Gar√ßas</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --azul: #0056a2; --claro: #00adef; 
            --verde: #2ecc71; --amarelo: #f1c40f; --vermelho: #e74c3c;
            --bg-glass: rgba(255, 255, 255, 0.12);
        }
        
        body { 
            margin: 0; font-family: 'Poppins', sans-serif; 
            background: radial-gradient(circle at top right, #003e75, #001a33);
            min-height: 100vh; display: flex; align-items: center; justify-content: center; color: white;
        }

        .container { width: 90%; max-width: 450px; perspective: 1000px; }

        .glass { 
            background: var(--bg-glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-radius: 30px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5); text-align: center;
            transition: all 0.5s ease;
        }

        h2 { font-weight: 600; font-size: 20px; margin-bottom: 25px; letter-spacing: 1px; }
        
        /* Menu em Cards */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .card-option {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 25px; border-radius: 20px; cursor: pointer; transition: 0.3s;
            display: flex; align-items: center; gap: 20px; text-align: left;
        }
        .card-option:hover { background: rgba(255,255,255,0.15); transform: translateY(-5px); border-color: var(--claro); }
        .card-icon { font-size: 30px; }

        /* Estilo dos Inputs */
        .input-group { text-align: left; margin-bottom: 15px; }
        label { font-size: 11px; text-transform: uppercase; font-weight: 600; margin-left: 5px; opacity: 0.8; }
        input, select, textarea { 
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); 
            background: rgba(0,0,0,0.2); color: white; font-family: 'Poppins'; margin-top: 5px; outline: none;
        }
        input:focus { border-color: var(--claro); background: rgba(0,0,0,0.4); }

        /* Bolinhas de Gravidade */
        .gravidade-container { display: flex; justify-content: space-between; margin: 20px 0; }
        .grav-item { flex: 1; text-align: center; cursor: pointer; opacity: 0.4; transition: 0.3s; }
        .grav-circle { width: 40px; height: 40px; border-radius: 50%; margin: 0 auto 8px; border: 3px solid transparent; }
        .grav-item.active { opacity: 1; transform: scale(1.1); }
        .grav-item.active .grav-circle { border-color: white; box-shadow: 0 0 15px currentColor; }

        .btn-main { 
            width: 100%; padding: 18px; border-radius: 15px; border: none; 
            background: linear-gradient(135deg, var(--azul), var(--claro)); 
            color: white; font-weight: bold; cursor: pointer; text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(0, 173, 239, 0.3); margin-top: 10px;
        }

        .hidden { display: none; opacity: 0; transform: scale(0.9); }
        .visible { display: block; opacity: 1; transform: scale(1); }
        
        .btn-back { background: none; border: none; color: rgba(255,255,255,0.5); margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginArea" class="glass">
        <h2>Seja Bem-vindo</h2>
        <div class="input-group">
            <label>Como devemos chamar voc√™?</label>
            <select id="setGen">
                <option value="Professor">Professor</option>
                <option value="Professora">Professora</option>
            </select>
        </div>
        <div class="input-group">
            <label>Seu Nome</label>
            <input type="text" id="profNome" placeholder="Ex: Marcos Oliveira">
        </div>
        <div class="input-group">
            <label>Prontu√°rio</label>
            <input type="text" id="profPront" placeholder="Digite seu registro">
        </div>
        <button class="btn-main" onclick="salvarUser()">Come√ßar</button>
    </div>

    <div id="mainMenu" class="glass hidden">
        <h2 id="saudacao">Ol√°!</h2>
        <div class="menu-grid">
            <div class="card-option" onclick="abrir('reservaArea')">
                <div class="card-icon">üìÖ</div>
                <div>
                    <div style="font-weight: 600;">Reservas</div>
                    <div style="font-size: 11px; opacity: 0.6;">Equipamentos e Salas</div>
                </div>
            </div>
            <div class="card-option" onclick="abrir('tiArea')">
                <div class="card-icon">üõ†Ô∏è</div>
                <div>
                    <div style="font-weight: 600;">Suporte TI</div>
                    <div style="font-size: 11px; opacity: 0.6;">Falar com o Kelvin</div>
                </div>
            </div>
        </div>
        <button class="btn-back" onclick="localStorage.clear(); location.reload();">Sair / Trocar Usu√°rio</button>
    </div>

    <div id="reservaArea" class="glass hidden">
        <h2>Nova Reserva</h2>
        <div class="input-group">
            <label>Equipamento</label>
            <select id="resEquip">
                <option>Sala de Inform√°tica</option>
                <option>Chromebooks</option>
                <option>TV Digital</option>
            </select>
        </div>
        <div class="input-group">
            <label>Hor√°rio de Retirada</label>
            <input type="datetime-local" id="hIni">
        </div>
        <div class="input-group">
            <label>Hor√°rio de Entrega</label>
            <input type="datetime-local" id="hFim">
        </div>
        <button class="btn-main" onclick="confirmarReserva()">Finalizar Reserva</button>
        <button class="btn-back" onclick="abrir('mainMenu')">‚Üê Voltar ao menu</button>
    </div>

    <div id="tiArea" class="glass hidden">
        <h2 style="margin-bottom: 0;">Suporte TI</h2>
        <p style="font-size: 12px; opacity: 0.7; margin-bottom: 20px;">Ol√°! Eu sou o Kelvin. Como posso ajudar?</p>
        
        <label>Qual a urg√™ncia?</label>
        <div class="gravidade-container">
            <div class="grav-item" id="v" onclick="setG('Verde', 'v')" style="color: var(--verde);">
                <div class="grav-circle" style="background: var(--verde);"></div>
                <div style="font-size: 9px;">Tranquilo</div>
            </div>
            <div class="grav-item" id="a" onclick="setG('Amarelo', 'a')" style="color: var(--amarelo);">
                <div class="grav-circle" style="background: var(--amarelo);"></div>
                <div style="font-size: 9px;">R√°pido</div>
            </div>
            <div class="grav-item" id="r" onclick="setG('Vermelho', 'r')" style="color: var(--vermelho);">
                <div class="grav-circle" style="background: var(--vermelho);"></div>
                <div style="font-size: 9px;">URGENTE</div>
            </div>
        </div>

        <div class="input-group">
            <label>Sua Sala</label>
            <input type="text" id="tiSala" placeholder="Ex: Sala 08">
        </div>
        <div class="input-group">
            <label>O que houve?</label>
            <textarea id="tiMsg" rows="3" placeholder="Descreva brevemente..."></textarea>
        </div>
        <button class="btn-main" onclick="solicitarTI()">Enviar Chamado</button>
        <button class="btn-back" onclick="abrir('mainMenu')">‚Üê Voltar ao menu</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBoGFDKz-nBwKvczGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let gravSel = "";
    let user = JSON.parse(localStorage.getItem('cmcg_v3'));

    window.onload = () => {
        if(user) { abrir('mainMenu'); }
    };

    window.abrir = (id) => {
        document.querySelectorAll('.glass').forEach(el => { el.style.display = 'none'; el.classList.remove('visible'); });
        const proxima = document.getElementById(id);
        proxima.style.display = 'block';
        setTimeout(() => proxima.classList.add('visible'), 50);

        if(id === 'mainMenu' && user) {
            document.getElementById('saudacao').innerText = (user.gen === 'Professor' ? "Bem-vindo, Prof. " : "Bem-vinda, Profa. ") + user.nome.split(' ')[0];
        }
    };

    window.salvarUser = () => {
        const n = document.getElementById('profNome').value;
        const p = document.getElementById('profPront').value;
        const g = document.getElementById('setGen').value;
        if(n && p) {
            user = { nome: n, pront: p, gen: g };
            localStorage.setItem('cmcg_v3', JSON.stringify(user));
            abrir('mainMenu');
        } else { alert("Preencha seus dados!"); }
    };

    window.setG = (cor, id) => {
        gravSel = cor;
        document.querySelectorAll('.grav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    };

    window.confirmarReserva = () => {
        const h1 = document.getElementById('hIni').value;
        const h2 = document.getElementById('hFim').value;
        if(!h1 || !h2) return alert("Preencha os hor√°rios.");
        
        set(push(ref(db, 'reservas')), { ...user, item: document.getElementById('resEquip').value, inicio: h1, fim: h2 })
        .then(() => { alert("Reservado!"); abrir('mainMenu'); });
    };

    window.solicitarTI = () => {
        const s = document.getElementById('tiSala').value;
        const m = document.getElementById('tiMsg').value;
        if(!gravSel || !s || !m) return alert("Preencha tudo.");

        set(push(ref(db, 'chamados_ti')), { ...user, sala: s, msg: m, gravidade: gravSel, data: new Date().toLocaleString() })
        .then(() => { alert("Kelvin avisado!"); abrir('mainMenu'); });
    };
</script>
</body>
</html>