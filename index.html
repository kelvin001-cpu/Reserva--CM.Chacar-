<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEMA NTI | Kelvin Almeida</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #00adef; --accent: #00ff9d; --danger: #ff4757;
            --dark: #020617; --glass: rgba(15, 23, 42, 0.95);
        }

        body { 
            margin: 0; font-family: 'Poppins', sans-serif; background: var(--dark); color: white;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        .intro-text { background: var(--glass); padding: 20px; border-radius: 20px; border: 1px solid var(--primary); margin: 20px auto; max-width: 800px; text-align: center; font-size: 13px; }
        .footer-credits { position: fixed; bottom: 10px; right: 20px; font-size: 11px; color: var(--primary); z-index: 1000; background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 5px; }

        #screen-auth { position: fixed; inset: 0; background: #000 url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072') center/cover; z-index: 5000; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        .portal-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; width: 90%; max-width: 1100px; padding-bottom: 50px; }
        .card-login { background: var(--glass); padding: 20px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }

        .main-layout { display: flex; flex: 1; overflow: hidden; }
        nav { width: 240px; background: #000; border-right: 1px solid #1e293b; padding: 20px; display: flex; flex-direction: column; gap: 5px; }
        .nav-link { padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px; color: #94a3b8; transition: 0.3s; font-size: 14px; }
        .nav-link:hover, .nav-link.active { background: var(--primary); color: white; }
        main { flex: 1; padding: 20px; overflow-y: auto; }
        .content-card { background: var(--glass); padding: 15px; border-radius: 12px; border: 1px solid #1e293b; margin-bottom: 15px; }

        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { padding: 10px; border-bottom: 1px solid #1e293b; text-align: left; }
        .btn-sm { padding: 5px 10px; font-size: 10px; margin: 2px; }

        #chat-container { height: 400px; display: flex; flex-direction: column; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; border: 1px solid #1e293b; }
        #chat-messages { flex: 1; overflow-y: auto; margin-bottom: 10px; display: flex; flex-direction: column; gap: 5px; }
        .msg { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px; font-size: 12px; }

        input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #334155; background: #000; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-blue { background: var(--primary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .hidden { display: none !important; }
        .banner-top { background: var(--danger); padding: 8px; text-align: center; font-weight: bold; font-size: 13px; display: none; }
    </style>
</head>
<body>

    <div id="ti-alert" class="banner-top">AVISO DO TI: <span id="ti-alert-msg"></span></div>

    <div id="screen-auth">
        <h1 style="color: var(--primary); margin-top: 30px;">SISTEMA NTI</h1>
        <div class="intro-text">Controle de tecnologia e gestão escolar - Desenvolvido por Kelvin Almeida.</div>
        <div class="portal-container">
            <div class="card-login"><i class="fa fa-chalkboard-user"></i><h3>PROFESSOR</h3><input type="number" id="p-pront" placeholder="Prontuário"><input type="password" id="p-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Professor')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Professor')">Criar Conta</button></div>
            <div class="card-login"><i class="fa fa-building-user"></i><h3>SECRETARIA</h3><input type="number" id="s-pront" placeholder="Prontuário"><input type="password" id="s-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Secretaria')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Secretaria')">Criar Conta</button></div>
            <div class="card-login"><i class="fa fa-user-tie"></i><h3>GESTÃO</h3><input type="number" id="g-pront" placeholder="Prontuário"><input type="password" id="g-pass" placeholder="Senha"><button class="btn btn-blue" onclick="app.login('Gestão')">ACESSAR</button><button class="btn" style="background:transparent; font-size:10px" onclick="app.abrirCad('Gestão')">Criar Conta</button></div>
            <div class="card-login" style="border: 2px solid var(--accent)"><i class="fa fa-terminal" style="color: var(--accent)"></i><h3 style="color: var(--accent)">TI MASTER</h3><input type="number" id="t-pront" placeholder="ID Kelvin"><input type="password" id="t-pass" placeholder="Senha Master"><button class="btn" style="background: var(--accent); color: #000;" onclick="app.login('TI')">TERMINAL MASTER</button></div>
        </div>
    </div>

    <div class="main-layout">
        <nav id="sidebar" class="hidden">
            <div style="text-align: center; border-bottom: 1px solid #1e293b; padding-bottom: 10px; margin-bottom: 10px;"><b id="user-display"></b><br><small id="cargo-display" style="color:var(--primary)"></small></div>
            <div class="nav-link active" onclick="app.view('v-dash')"><i class="fa fa-home"></i> Início</div>
            <div class="nav-link" onclick="app.view('v-chat')"><i class="fa fa-comments"></i> Chat Escola</div>
            <div class="nav-link" onclick="app.view('v-chamado')"><i class="fa fa-headset"></i> Chamado NTI</div>
            <div id="m-servicos" class="hidden"><div class="nav-link" onclick="app.view('v-reservar')"><i class="fa fa-calendar-check"></i> Reservar Item</div></div>
            <div id="m-gestao" class="hidden"><div class="nav-link" onclick="app.view('v-monitor')"><i class="fa fa-desktop"></i> Monitoramento</div></div>
            <div id="m-ti" class="hidden"><div class="nav-link" style="color: var(--accent)" onclick="app.view('v-ti-master')"><i class="fa fa-shield-halved"></i> PAINEL MASTER</div></div>
            <button class="btn btn-danger" style="margin-top:auto" onclick="location.reload()">SAIR</button>
        </nav>

        <main id="app-main" class="hidden">
            <div id="v-dash" class="view"><h2>Equipamentos em Uso</h2><div id="lista-atividades"></div></div>
            <div id="v-reservar" class="view hidden"><h3>Reserva de Itens</h3><div id="grid-itens" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;"></div></div>
            <div id="v-chat" class="view hidden"><h3>Chat Escola</h3><div id="chat-container"><div id="chat-messages"></div><div style="display: flex; gap: 10px;"><input type="text" id="chat-input" placeholder="Mensagem..."><button class="btn btn-blue" style="width: 80px; margin: 0;" onclick="app.sendChat()">OK</button></div></div></div>
            <div id="v-chamado" class="view hidden"><h3>Novo Chamado NTI</h3><div class="content-card" style="max-width: 400px;"><select id="ch-tipo"><option>Internet</option><option>Projetor</option><option>Hardware</option><option>Software</option></select><textarea id="ch-desc" rows="3" placeholder="O que aconteceu?"></textarea><button class="btn btn-blue" onclick="app.enviarChamado()">ABRIR CHAMADO</button></div></div>
            <div id="v-monitor" class="view hidden"><h3>Relatório de Uso</h3><div class="content-card"><table><thead><tr><th>Quem</th><th>Item</th><th>Local</th><th>Hora</th></tr></thead><tbody id="tab-monitor"></tbody></table></div></div>

            <div id="v-ti-master" class="view hidden">
                <h2 style="color: var(--accent)">Terminal Kelvin Almeida</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="content-card">
                        <h4>Controle do Site</h4>
                        <button class="btn btn-danger btn-sm" onclick="app.tiCmd('lock', true)">LOCKDOWN</button>
                        <button class="btn btn-sm" style="background:green;color:white" onclick="app.tiCmd('lock', false)">LIBERAR</button>
                        <input type="text" id="ti-msg" placeholder="Aviso importante..."><button class="btn btn-blue btn-sm" onclick="app.tiCmd('banner', true)">POSTAR BANNER</button>
                    </div>
                    <div class="content-card">
                        <h4>Ações Rápidas</h4>
                        <button class="btn btn-danger btn-sm" onclick="app.limparTudo('atividades')">LIMPAR RESERVAS</button>
                        <button class="btn btn-sm" onclick="app.limparTudo('chat')">LIMPAR CHAT</button>
                    </div>
                </div>
                <h3>Gerenciar Usuários</h3><div class="content-card" style="overflow-x: auto;"><table><thead><tr><th>Nome</th><th>Pront.</th><th>Cargo</th><th>Status</th><th>Ações</th></tr></thead><tbody id="ti-user-list"></tbody></table></div>
                <h3>Chamados NTI</h3><div id="ti-chamados-list"></div>
            </div>
        </main>
    </div>

    <div id="modal-cad" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.95); z-index:6000; display:flex; align-items:center; justify-content:center;">
        <div class="card-login" style="width:300px"><h3 id="cad-nome-portal">Cadastro</h3><input type="text" id="c-nome" placeholder="Nome Completo"><input type="number" id="c-pront-new" placeholder="Prontuário"><button class="btn btn-blue" onclick="app.confirmarCad()">CRIAR</button><button class="btn" onclick="document.getElementById('modal-cad').classList.add('hidden')">SAIR</button></div>
    </div>

    <div class="footer-credits">Kelvin Almeida estagiário do programa conect desenvolveu sistema NTI</div>

<script>
    const firebaseConfig = { databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: null, tempPortal: '',
        abrirCad(p) { this.tempPortal = p; document.getElementById('cad-nome-portal').innerText = "Novo " + p; document.getElementById('modal-cad').classList.remove('hidden'); },
        async confirmarCad() {
            const n = document.getElementById('c-nome').value, p = document.getElementById('c-pront-new').value;
            if(!n || !p) return alert("Preencha tudo!");
            let s = (this.tempPortal==='Gestão')?'gestao2026':(this.tempPortal==='Secretaria')?'secretaria2026':'pmsp2026';
            await db.ref('usuarios/'+p).set({ nome: n, pront: p, cargo: this.tempPortal, pass: s, status: 'ativo' });
            alert("Criado! Senha padrão: " + s); document.getElementById('modal-cad').classList.add('hidden');
        },
        async login(portal) {
            let p = document.getElementById(portal==='Professor'?'p-pront':portal==='Secretaria'?'s-pront':portal==='Gestão'?'g-pront':'t-pront').value;
            let s = document.getElementById(portal==='Professor'?'p-pass':portal==='Secretaria'?'s-pass':portal==='Gestão'?'g-pass':'t-pass').value;

            // ACESSO TI KELVIN ATUALIZADO
            if(portal === 'TI' && p === '46690' && s === 'nti2026') { 
                this.user = { nome: 'Kelvin Almeida', cargo: 'TI', pront: '46690' }; return this.iniciar(); 
            }

            const snap = await db.ref('usuarios/'+p).once('value');
            if(snap.exists()) {
                const u = snap.val();
                if(u.status === 'bloqueado') return alert("Conta BLOQUEADA pelo TI.");
                if(u.pass === s && u.cargo === portal) { this.user = u; this.iniciar(); } else alert("Senha incorreta.");
            } else alert("Usuário não encontrado.");
        },
        iniciar() {
            document.getElementById('screen-auth').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('app-main').classList.remove('hidden');
            document.getElementById('user-display').innerText = this.user.nome;
            document.getElementById('cargo-display').innerText = this.user.cargo;
            if(this.user.cargo === 'Professor' || this.user.cargo === 'Secretaria' || this.user.cargo === 'TI') document.getElementById('m-servicos').classList.remove('hidden');
            if(this.user.cargo === 'Gestão' || this.user.cargo === 'TI') document.getElementById('m-gestao').classList.remove('hidden');
            if(this.user.cargo === 'TI') document.getElementById('m-ti').classList.remove('hidden');
            this.sync();
        },
        view(id) { document.querySelectorAll('.view').forEach(v => v.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); },
        sync() {
            db.ref('config/lock').on('value', s => { if(s.val() && this.user.cargo !== 'TI') document.body.innerHTML = "<h2 style='text-align:center;padding:50px;color:white'>SISTEMA BLOQUEADO PELO TI KELVIN</h2>"; });
            db.ref('config/banner').on('value', s => { const b = document.getElementById('ti-alert'); if(s.val() && s.val().ativo) { b.style.display = 'block'; document.getElementById('ti-alert-msg').innerText = s.val().msg; } else b.style.display = 'none'; });
            const itens = ['TV 01', 'TV 02', 'TV 03', 'CROME 01', 'CROME 02', 'TABLETS'];
            db.ref('atividades').on('value', snap => {
                const list = document.getElementById('lista-atividades'), grid = document.getElementById('grid-itens'), tab = document.getElementById('tab-monitor');
                list.innerHTML = ""; grid.innerHTML = ""; tab.innerHTML = ""; let o = {};
                snap.forEach(a => { const d = a.val(); if(d.status === 'ativo') { o[d.item] = true; list.innerHTML += `<div class="content-card"><b>${d.item}</b>: ${d.user} (${d.sala}) ${this.user.cargo==='TI'?`<button class="btn btn-danger btn-sm" style="width:auto;margin-left:10px" onclick="app.remover('atividades/${a.key}')">BAIXA</button>`:''}</div>`; tab.innerHTML += `<tr><td>${d.user}</td><td>${d.item}</td><td>${d.sala}</td><td>${d.hora}</td></tr>`; } });
                itens.forEach(i => { grid.innerHTML += `<div class="card-login" style="padding:10px"><b>${i}</b><br><small style="color:${o[i]?'red':'green'}">${o[i]?'USO':'LIVRE'}</small>${!o[i]?`<button class="btn btn-blue" style="font-size:10px" onclick="app.reservar('${i}')">PEGAR</button>`:''}</div>`; });
            });
            db.ref('chamados').on('value', snap => {
                const tiL = document.getElementById('ti-chamados-list');
                if(tiL) { tiL.innerHTML = ""; snap.forEach(c => { const d = c.val(); tiL.innerHTML += `<div class="content-card"><b>${d.tipo}</b> - ${d.user}<br><p>${d.desc}</p><button class="btn btn-danger btn-sm" onclick="app.remover('chamados/${c.key}')">OK</button></div>`; }); }
            });
            db.ref('chat').limitToLast(20).on('value', snap => {
                const cb = document.getElementById('chat-messages'); cb.innerHTML = "";
                snap.forEach(m => { const d = m.val(); cb.innerHTML += `<div class="msg"><b>${d.user}:</b> ${d.text}</div>`; });
                cb.scrollTop = cb.scrollHeight;
            });
            if(this.user.cargo === 'TI') {
                db.ref('usuarios').on('value', snap => {
                    const ul = document.getElementById('ti-user-list'); ul.innerHTML = "";
                    snap.forEach(u => { const d = u.val(); ul.innerHTML += `<tr><td>${d.nome}</td><td>${d.pront}</td><td>${d.cargo}</td><td>${d.status}</td><td><button class="btn btn-danger btn-sm" onclick="app.gerirU('${d.pront}','bloqueado')">BAN</button><button class="btn btn-sm" style="background:green;color:white" onclick="app.gerirU('${d.pront}','ativo')">OK</button><button class="btn btn-sm" onclick="app.remover('usuarios/${d.pront}')">DEL</button></td></tr>`; });
                });
            }
        },
        async reservar(item) { const s = prompt("Sala?"); if(s) await db.ref('atividades').push({ item, user: this.user.nome, sala: s, hora: new Date().toLocaleTimeString(), status: 'ativo' }); },
        async enviarChamado() { const d = document.getElementById('ch-desc').value; if(d) { await db.ref('chamados').push({ tipo: document.getElementById('ch-tipo').value, desc: d, user: this.user.nome }); alert("Aberto!"); document.getElementById('ch-desc').value=""; } },
        remover(p) { if(confirm("Confirmar?")) db.ref(p).remove(); },
        gerirU(p, s) { db.ref('usuarios/'+p).update({ status: s }); },
        limparTudo(p) { if(confirm("Limpar tudo?")) db.ref(p).remove(); },
        sendChat() { const i = document.getElementById('chat-input'); if(i.value) { db.ref('chat').push({ user: this.user.nome, text: i.value }); i.value = ""; } },
        tiCmd(c, v) { if(c==='lock') db.ref('config/lock').set(v); if(c==='banner') db.ref('config/banner').set({ ativo: v, msg: document.getElementById('ti-msg').value }); }
    };
</script>
</body>
</html>
