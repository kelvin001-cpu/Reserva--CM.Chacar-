<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
    // --- SUA CONFIGURAÇÃO (Complete com seus dados do console) ---
    const firebaseConfig = {
        apiKey: "AIzaSyBoGfDKz-nBwKvczzGpxg-fHJYdVykcBUQ",
        authDomain: "SEU-PROJETO.firebaseapp.com",
        databaseURL: "https://SEU-PROJETO-default-rtdb.firebaseio.com",
        projectId: "SEU-PROJETO",
        storageBucket: "SEU-PROJETO.appspot.com",
        messagingSenderId: "123456789",
        appId: "SEU-APP-ID"
    };

    // Inicializa o Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        equip: "",
        ativos: ['SALA INFO', 'CHROMEBOOKS', 'TV 01', 'TV 02', 'TV 03'],

        nav(at, px) {
            document.querySelectorAll('.balao-premium > div[id^="scr"]').forEach(d => d.classList.add('hidden'));
            document.getElementById(`scr${px}`).classList.remove('hidden');
            if(px === 6) this.ouvirDadosCloud(); // Liga a escuta em tempo real
        },

        validarPerfil() {
            if(!document.getElementById('p-nome').value) return alert("Digite seu nome!");
            this.nav(1, 2);
        },

        setEq(val, id) {
            this.equip = val;
            document.querySelectorAll('#scr3 .btn-item').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        },

        toggleAgenda() {
            const tipo = document.getElementById('res-tipo').value;
            document.getElementById('area-recorrente').classList.toggle('hidden', tipo !== 'RECORRENTE');
        },

        // --- SALVAR NO FIREBASE ---
        confirmarReserva() {
            const tipo = document.getElementById('res-tipo').value;
            const hora = document.getElementById('res-hora-fim').value;
            const prof = document.getElementById('p-nome').value;

            if(!this.equip || !hora) return alert("Preencha tudo!");

            const novaReserva = {
                prof: prof,
                equip: this.equip,
                tipo: tipo,
                hora: hora,
                dia: tipo === 'RECORRENTE' ? document.getElementById('res-dia').value : 'Hoje',
                expira: tipo === 'RECORRENTE' ? document.getElementById('res-semanas').value + " semanas" : 'Hoje',
                timestamp: Date.now()
            };

            // Envia para o Firebase
            db.ref('reservas_elite').push(novaReserva)
                .then(() => {
                    alert("RESERVA SINCRONIZADA NA NUVEM!");
                    this.nav(3, 2);
                })
                .catch(err => alert("Erro ao salvar: " + err.message));
        },

        // --- ESCUTAR DADOS DA NUVEM (REALTIME) ---
        ouvirDadosCloud() {
            const container = document.getElementById('admin-monitor');
            
            // O '.on' faz a tela atualizar sozinha quando alguém reserva algo
            db.ref('reservas_elite').on('value', (snapshot) => {
                const dados = snapshot.val();
                if(!dados) {
                    container.innerHTML = "<p style='font-size:12px; opacity:0.5'>Nenhuma reserva ativa.</p>";
                    return;
                }

                const keys = Object.keys(dados);
                container.innerHTML = keys.map((key) => {
                    const r = dados[key];
                    return `
                        <div class="monitor-card" style="border-left-color: ${r.tipo === 'RECORRENTE' ? 'var(--azul-sky)' : 'var(--neon)'}">
                            <div style="display:flex; justify-content:space-between">
                                <b>${r.equip}</b>
                                <small style="color:var(--azul-sky)">${r.tipo}</small>
                            </div>
                            <div style="margin-top:5px; opacity:0.9">
                                Prof: ${r.prof}<br>
                                Dia: ${r.dia} | Fim: ${r.hora}h<br>
                                Duração: ${r.expira}
                            </div>
                            <button onclick="app.excluirReserva('${key}')" style="background:none; border:none; color:red; font-size:9px; padding:0; cursor:pointer; margin-top:10px; font-weight:bold">DELETAR RESERVA</button>
                        </div>
                    `;
                }).reverse().join('');
            });
        },

        // --- EXCLUIR DO FIREBASE ---
        excluirReserva(idNoFirebase) {
            if(confirm("Deseja apagar essa reserva para todos?")) {
                db.ref('reservas_elite').child(idNoFirebase).remove();
            }
        }
    };

    setInterval(() => {
        document.getElementById('relogio-top').innerText = new Date().toLocaleString('pt-BR');
    }, 1000);
</script>
