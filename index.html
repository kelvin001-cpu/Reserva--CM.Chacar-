<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<script>
    // Zé, preencha a API KEY que você pega na engrenagem do seu Firebase
    const firebaseConfig = {
        apiKey: "COLE_AQUI_SUA_API_KEY", 
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.appspot.com"
    };
    
    // Inicializa
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const database = firebase.database();

    const app = {
        equip: "", grau: "",

        // FUNÇÃO PARA ENVIAR CHAMADO (COM TRAVA TOTAL)
        enviarChamado() {
            const nome = document.getElementById('p-nome').value;
            const pront = document.getElementById('p-id').value;
            const mot = document.getElementById('sup-motivo').value;

            // TRAVA OBRIGATÓRIA - NÃO DEIXA PASSAR SEM TUDO PREENCHIDO
            if(!nome || !pront || !this.grau || !mot) {
                return alert("⚠️ SISTEMA TRAVADO: Preencha seu nome, selecione a cor da urgência e descreva o problema!");
            }

            const dados = {
                professor: nome,
                prontuario: pront,
                urgencia: this.grau,
                problema: mot,
                data: new Date().toLocaleString('pt-BR'),
                status: "Aberto"
            };

            // Envia para a pasta 'chamados'
            database.ref('chamados').push(dados)
                .then(() => {
                    alert("✅ SUCESSO! O chamado foi enviado para o Zé (ADM).");
                    location.reload(); // Limpa a tela
                })
                .catch(e => alert("ERRO: " + e.message));
        },

        // FUNÇÃO PARA ENVIAR RESERVA (COM TRAVA TOTAL)
        enviarReserva() {
            const nome = document.getElementById('p-nome').value;
            const ini = document.getElementById('res-inicio').value;
            const fim = document.getElementById('res-fim').value;
            const sala = document.getElementById('res-sala-manual').value;

            if(!nome || !ini || !fim || !sala || !this.equip) {
                return alert("⚠️ SISTEMA TRAVADO: Preencha todos os campos da reserva!");
            }

            const reserva = {
                professor: nome,
                inicio: ini,
                fim: fim,
                sala: sala,
                equipamento: this.equip,
                data_registro: new Date().toLocaleString('pt-BR')
            };

            database.ref('reservas').push(reserva)
                .then(() => {
                    alert("✅ RESERVA SALVA COM SUCESSO!");
                    location.reload();
                })
                .catch(e => alert("ERRO: " + e.message));
        }
    };
</script>
