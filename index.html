<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANTANA TECH - RESERVA EDUCA√á√ÉO</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-green: #39ff14; --dark-bg: #05060a; }
        body { 
            margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--dark-bg); color: white;
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }
        header { border-bottom: 2px solid var(--neon-blue); padding: 20px; text-align: center; background: rgba(0,0,0,0.8); }
        .container { max-width: 500px; margin: 20px auto; padding: 20px; }
        .card { 
            background: rgba(20, 25, 40, 0.9); border: 1px solid var(--neon-blue); 
            border-radius: 20px; padding: 25px; box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
        }
        h2 { font-family: 'Orbitron'; color: var(--neon-blue); text-align: center; font-size: 18px; }
        
        .menu-setores { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
        .item-btn { 
            background: rgba(255,255,255,0.05); border: 1px solid #333; padding: 15px; 
            border-radius: 12px; cursor: pointer; text-align: center; transition: 0.3s;
        }
        .item-btn:hover, .item-btn.active { border-color: var(--neon-blue); background: rgba(0,243,255,0.1); }
        
        input, select, button { 
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; 
            background: #000; border: 1px solid var(--neon-blue); color: white; box-sizing: border-box;
        }
        .btn-ready { 
            background: linear-gradient(90deg, var(--neon-blue), #bc13fe); 
            font-family: 'Orbitron'; font-weight: bold; cursor: pointer; border: none; margin-top: 15px;
        }
        .btn-finish { background: var(--neon-green); color: black; font-weight: bold; margin-top: 20px; cursor: pointer; }
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1 style="font-family:'Orbitron'; font-size: 20px; margin:0;">TECH-RESERVA CH√ÅCARA</h1>
</header>

<div class="container">
    <div id="loginCard" class="card">
        <h2>IDENTIFICA√á√ÉO DOCENTE</h2>
        <input type="text" id="nomeProf" placeholder="Nome do Professor">
        <button class="btn-ready" onclick="entrar()">INICIAR PROTOCOLO</button>
    </div>

    <div id="reservaCard" class="card hidden">
        <h2>RESERVA DE AMBIENTES</h2>
        
        <div class="menu-setores">
            <div class="item-btn" onclick="selecionar('SALA DE INFORM√ÅTICA', this)">üñ•Ô∏è SALA INFO</div>
            <div class="item-btn" onclick="selecionar('LABORAT√ìRIO TECH', this)">üî¨ LAB TECH</div>
            <div class="item-btn" onclick="selecionar('SALA MULTIM√çDIA', this)">üìΩÔ∏è MULTIM√çDIA</div>
            <div class="item-btn" onclick="selecionar('CARRINHO CHROMEBOOK', this)">üíª CHROMEBOOKS</div>
        </div>

        <div id="subChrome" class="hidden">
            <label>QUANTIDADE DE UNIDADES:</label>
            <select id="qtdChrome">
                <option value="Carrinho Completo">Carrinho Completo</option>
                <option value="10 unidades">10 unidades</option>
                <option value="20 unidades">20 unidades</option>
            </select>
        </div>

        <label>DATA E HORA DE IN√çCIO:</label>
        <input type="datetime-local" id="horaInicio">

        <label>DURA√á√ÉO ESTIMADA:</label>
        <select id="tempoUso">
            <option value="45">45 min (1 Aula)</option>
            <option value="90">90 min (2 Aulas)</option>
            <option value="180">Manh√£/Tarde Toda</option>
        </select>

        <button class="btn-ready" onclick="agendar()">CONFIRMAR AGENDAMENTO</button>
    </div>

    <div id="usoCard" class="card hidden">
        <h2 style="color: var(--neon-green)">EQUIPAMENTO EM USO</h2>
        <p id="detalheReserva" style="text-align: center; border: 1px dashed var(--neon-green); padding: 10px;"></p>
        <p style="font-size: 12px; color: #aaa; text-align: center;">Ap√≥s terminar o uso, clique abaixo para liberar o sistema automaticamente.</p>
        <button class="btn-finish" onclick="finalizarUso()">FINALIZAR E ENTREGAR AGORA</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBoGFDKz-nBwKvczGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let profGlobal = ""; let salaGlobal = ""; let reservaID = "";

    window.entrar = () => {
        profGlobal = document.getElementById('nomeProf').value;
        if(profGlobal) {
            document.getElementById('loginCard').classList.add('hidden');
            document.getElementById('reservaCard').classList.remove('hidden');
        }
    };

    window.selecionar = (sala, el) => {
        salaGlobal = sala;
        document.querySelectorAll('.item-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('subChrome').classList.toggle('hidden', sala !== 'CARRINHO CHROMEBOOK');
    };

    window.agendar = () => {
        const inicio = document.getElementById('horaInicio').value;
        const duracao = parseInt(document.getElementById('tempoUso').value);
        if(!salaGlobal || !inicio) return alert("ERRO: Selecione a sala e o hor√°rio!");

        const dataInicio = new Date(inicio);
        const dataFim = new Date(dataInicio.getTime() + duracao * 60000);
        
        let equipFinal = salaGlobal;
        if(salaGlobal === 'CARRINHO CHROMEBOOK') equipFinal += " (" + document.getElementById('qtdChrome').value + ")";

        const novaReserva = push(ref(db, 'reservas'));
        reservaID = novaReserva.key;

        set(novaReserva, {
            prof: profGlobal,
            local: equipFinal,
            inicio: dataInicio.toLocaleString(),
            entrega: dataFim.toLocaleString()
        }).then(() => {
            document.getElementById('reservaCard').classList.add('hidden');
            document.getElementById('usoCard').classList.remove('hidden');
            document.getElementById('detalheReserva').innerText = equipFinal + " reservado por " + profGlobal;
        });
    };

    window.finalizarUso = () => {
        if(confirm("Deseja confirmar a entrega e liberar o equipamento?")) {
            remove(ref(db, 'reservas/' + reservaID)).then(() => {
                alert("SISTEMA ATUALIZADO: Equipamento dispon√≠vel!");
                location.reload();
            });
        }
    };
</script>
</body>
</html>
