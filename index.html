<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA NTi - CH√ÅCARA DAS GAR√áAS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --azul-pref: #004a99; --azul-sky: #00adef; --neon: #00ff9d;
            --nivel-1: #2ed573; --nivel-2: #ffa502; --nivel-3: #ff4757;
            --glass: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; transition: 0.3s; }
        
        body { 
            margin: 0; background: #000b1a url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=2072&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover; min-height: 100vh; display: flex; align-items: center; justify-content: center; color: white; padding: 10px;
        }

        .balao-premium {
            width: 100%; max-width: 500px; background: var(--glass);
            backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2); border-radius: 30px;
            padding: 25px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); text-align: center;
        }

        .hidden { display: none; }
        .clock-header { font-size: 12px; font-weight: 600; color: var(--azul-sky); margin-bottom: 20px; }
        
        /* Formul√°rios e Inputs */
        .campo { width: 100%; height: 45px; background: white; border-radius: 12px; border: none; padding: 0 15px; font-size: 14px; color: #111; margin-bottom: 15px; font-weight: 600; }
        .label-mini { display: block; text-align: left; font-size: 10px; font-weight: 700; color: var(--azul-sky); margin-left: 5px; text-transform: uppercase; }

        /* Bot√µes */
        .btn-acao { width: 100%; height: 50px; border-radius: 15px; border: none; background: linear-gradient(135deg, var(--azul-pref), var(--azul-sky)); color: white; font-weight: 700; cursor: pointer; margin-bottom: 10px; font-size: 13px; }
        .btn-acao:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,173,239,0.4); }
        .btn-voltar { background: none; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 10px; border-radius: 12px; width: 100%; cursor: pointer; font-size: 11px; }

        /* Grid de Equipamentos */
        .grid-eq { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .btn-eq { height: 45px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 10px; color: white; font-size: 9px; font-weight: 700; cursor: pointer; }
        .btn-eq.active { background: var(--azul-sky); border-color: white; }

        /* Cards do Cronograma */
        .card { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 15px; margin-bottom: 10px; text-align: left; border-left: 5px solid var(--neon); }
        .card-entrega { border-left-color: #888; opacity: 0.6; }
        .btn-entregar { background: var(--neon); color: #000; border: none; padding: 8px; border-radius: 8px; width: 100%; margin-top: 10px; font-weight: 800; cursor: pointer; font-size: 11px; }
    </style>
</head>
<body>

    <div class="balao-premium">
        <div class="clock-header" id="relogio-top">00/00/0000 00:00:00</div>

        <div id="tela-inicio">
            <h1>SISTEMA NTi</h1>
            <p style="font-size: 12px; opacity: 0.8; margin-bottom: 25px;">Escolha o portal de acesso:</p>
            <button class="btn-acao" onclick="app.irPara('login-prof')">SOU PROFESSOR</button>
            <button class="btn-acao" style="background: #333;" onclick="app.irPara('login-gestor')">SOU GESTOR / SECRETARIA</button>
        </div>

        <div id="tela-login-gestor" class="hidden">
            <h2>ACESSO GESTOR</h2>
            <input type="password" class="campo" id="pass-gestor" placeholder="Senha de Acesso">
            <button class="btn-acao" onclick="app.authGestor()">ENTRAR NO PAINEL</button>
            <button class="btn-voltar" onclick="app.irPara('inicio')">VOLTAR</button>
        </div>

        <div id="tela-login-prof" class="hidden">
            <h2>IDENTIFICA√á√ÉO</h2>
            <input type="text" class="campo" id="p-nome" placeholder="Nome Completo">
            <input type="text" class="campo" id="p-id" placeholder="RP / Prontu√°rio">
            <input type="text" class="campo" id="p-mat" placeholder="Disciplina">
            <button class="btn-acao" onclick="app.authProf()">ACESSAR SISTEMA</button>
            <button class="btn-voltar" onclick="app.irPara('inicio')">VOLTAR</button>
        </div>

        <div id="tela-menu" class="hidden">
            <h3 id="boas-vindas" style="margin-bottom: 5px;">Ol√°!</h3>
            <p id="sub-info" style="font-size: 10px; color: var(--azul-sky); margin-bottom: 20px;"></p>
            
            <div id="area-prof-only">
                <button class="btn-acao" onclick="app.irPara('reserva')">üìÖ NOVA RESERVA</button>
            </div>
            
            <button class="btn-acao" style="background: rgba(0,173,239,0.2);" onclick="app.abrirCronograma()">üñ•Ô∏è CRONOGRAMA & CALEND√ÅRIO</button>
            <button class="btn-acao" style="background: var(--nivel-3);" onclick="app.irPara('suporte')">üõ†Ô∏è CHAMADO T√âCNICO</button>
            <button class="btn-voltar" onclick="location.reload()">SAIR</button>
        </div>

        <div id="tela-reserva" class="hidden">
            <h3>RESERVAR EQUIPAMENTO</h3>
            <div class="grid-eq">
                <button class="btn-eq" id="e1" onclick="app.selectEq('SALA INFO', 'e1')">SALA INFO</button>
                <button class="btn-eq" id="e2" onclick="app.selectEq('CHROMEBOOKS', 'e2')">CHROMEBOOKS</button>
                <button class="btn-eq" id="e3" onclick="app.selectEq('TV 01', 'e3')">TV 01</button>
                <button class="btn-eq" id="e4" onclick="app.selectEq('TV 02', 'e4')">TV 02</button>
                <button class="btn-eq" id="e5" onclick="app.selectEq('TV 03', 'e5')">TV 03</button>
            </div>
            <span class="label-mini">Data de Uso:</span>
            <input type="date" class="campo" id="res-data">
            <span class="label-mini">Hora de Devolu√ß√£o:</span>
            <input type="time" class="campo" id="res-hora-fim">
            <button class="btn-acao" onclick="app.confirmarReserva()">SALVAR AGENDAMENTO</button>
            <button class="btn-voltar" onclick="app.irPara('menu')">CANCELAR</button>
        </div>

        <div id="tela-cronograma" class="hidden">
            <h3>CRONOGRAMA</h3>
            <span class="label-mini">Filtrar por data:</span>
            <input type="date" class="campo" id="filtro-data" onchange="app.renderizarLista()">
            
            <div id="lista-atividades" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                </div>
            <button class="btn-voltar" style="margin-top: 15px;" onclick="app.irPara('menu')">VOLTAR</button>
        </div>

        <div id="tela-suporte" class="hidden">
            <h3>ABRIR CHAMADO</h3>
            <input type="text" class="campo" id="sup-local" placeholder="Local / Sala">
            <textarea class="campo" id="sup-motivo" style="height: 80px; padding-top: 10px;" placeholder="Qual o problema t√©cnico?"></textarea>
            <button class="btn-acao" style="background: var(--nivel-3);" onclick="app.enviarSuporte()">ENVIAR URG√äNCIA</button>
            <button class="btn-voltar" onclick="app.irPara('menu')">VOLTAR</button>
        </div>

    </div>

<script>
    // CONFIGURA√á√ÉO FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyBoGfDKz-nBwKvczzGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const app = {
        user: { nome: "", id: "", mat: "", tipo: "" },
        selectedEq: "",

        irPara(tela) {
            document.querySelectorAll('.balao-premium > div').forEach(d => {
                if(d.id !== 'relogio-top') d.classList.add('hidden');
            });
            document.getElementById('tela-' + tela).classList.remove('hidden');
        },

        authGestor() {
            const pass = document.getElementById('pass-gestor').value;
            if(pass === "gestores2026") {
                this.user = { nome: "GESTOR NTi", tipo: "gestor" };
                document.getElementById('boas-vindas').innerText = "Painel de Gest√£o";
                document.getElementById('sub-info').innerText = "Monitoramento Completo Ativado";
                document.getElementById('area-prof-only').classList.add('hidden');
                this.irPara('menu');
            } else { alert("Senha incorreta!"); }
        },

        authProf() {
            this.user.nome = document.getElementById('p-nome').value.toUpperCase();
            this.user.id = document.getElementById('p-id').value;
            this.user.mat = document.getElementById('p-mat').value.toUpperCase();
            this.user.tipo = "prof";
            if(!this.user.nome || !this.user.id) return alert("Preencha seus dados!");
            document.getElementById('boas-vindas').innerText = "Ol√°, Prof. " + this.user.nome.split(' ')[0];
            document.getElementById('sub-info').innerText = "Disciplina: " + this.user.mat;
            document.getElementById('area-prof-only').classList.remove('hidden');
            this.irPara('menu');
        },

        selectEq(eq, btnId) {
            this.selectedEq = eq;
            document.querySelectorAll('.btn-eq').forEach(b => b.classList.remove('active'));
            document.getElementById(btnId).classList.add('active');
        },

        confirmarReserva() {
            const data = document.getElementById('res-data').value;
            const hora = document.getElementById('res-hora-fim').value;
            if(!this.selectedEq || !data || !hora) return alert("Complete todos os campos da reserva!");

            db.ref('atividades').push({
                prof: this.user.nome,
                rp: this.user.id,
                materia: this.user.mat,
                equipamento: this.selectedEq,
                dataUso: data,
                horaEntrega: hora,
                status: "EM USO",
                timestamp: Date.now()
            });

            alert("Reserva confirmada!");
            this.irPara('menu');
        },

        entregar(key) {
            if(confirm("Confirmar a entrega deste equipamento agora?")) {
                db.ref('atividades/' + key).update({ status: "ENTREGUE" });
            }
        },

        abrirCronograma() {
            document.getElementById('filtro-data').valueAsDate = new Date();
            this.irPara('cronograma');
            this.renderizarLista();
        },

        renderizarLista() {
            const lista = document.getElementById('lista-atividades');
            const dataFiltro = document.getElementById('filtro-data').value;
            
            db.ref('atividades').on('value', (snap) => {
                lista.innerHTML = "";
                snap.forEach(item => {
                    const r = item.val();
                    const key = item.key;

                    if(r.dataUso === dataFiltro || !r.dataUso) { // Filtra por dia
                        const entregue = r.status === "ENTREGUE";
                        const infoRp = this.user.tipo === 'gestor' ? `<br><b>RP:</b> ${r.rp || 'N/A'}` : '';

                        lista.innerHTML += `
                            <div class="card ${entregue ? 'card-entrega' : ''}">
                                <div style="display:flex; justify-content:space-between; align-items:start;">
                                    <b>${r.equipamento || 'üõ†Ô∏è SUPORTE'}</b>
                                    <small>${r.horaEntrega || ''}</small>
                                </div>
                                <div style="font-size:11px; margin-top:5px;">
                                    <b>Prof:</b> ${r.prof} ${infoRp} <br>
                                    <b>Status:</b> ${r.status}
                                </div>
                                ${(!entregue && (r.prof === this.user.nome || this.user.tipo === 'gestor')) ? 
                                    `<button class="btn-entregar" onclick="app.entregar('${key}')">DAR BAIXA / ENTREGAR</button>` : ''}
                            </div>
                        `;
                    }
                });
                if(lista.innerHTML === "") lista.innerHTML = "<p style='font-size:12px; opacity:0.5;'>Nenhuma reserva para este dia.</p>";
            });
        },

        enviarSuporte() {
            const local = document.getElementById('sup-local').value;
            const motivo = document.getElementById('sup-motivo').value;
            if(!local || !motivo) return alert("Preencha os detalhes do problema!");

            db.ref('atividades').push({
                prof: this.user.nome,
                equipamento: "SUPORTE: " + local,
                status: "CHAMADO ABERTO",
                motivo: motivo,
                timestamp: Date.now()
            });
            alert("Suporte solicitado!");
            this.irPara('menu');
        }
    };

    // Rel√≥gio
    setInterval(() => {
        document.getElementById('relogio-top').innerText = new Date().toLocaleString('pt-BR');
    }, 1000);
</script>
</body>
</html>
