<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SANTANA TECH - ADMINISTRAÇÃO MASTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-red: #ff0055; --bg-dark: #08090d; --card: #12141d; }
        
        body { 
            margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg-dark); color: white;
            min-height: 100vh;
        }

        /* 1. TELA DE LOGIN (BLOQUEIO TOTAL) */
        #telaLogin {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: var(--card); border: 1px solid var(--neon-blue); padding: 40px;
            width: 320px; text-align: center; border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.1);
        }
        .login-box input {
            width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333;
            color: var(--neon-blue); border-radius: 5px; outline: none; box-sizing: border-box;
        }
        .btn-entrar {
            width: 100%; padding: 12px; background: var(--neon-blue); color: #000; border: none;
            font-family: 'Orbitron'; font-weight: bold; cursor: pointer; border-radius: 5px;
        }

        /* 2. ESTRUTURA DO PAINEL (ESCONDIDO ATÉ LOGAR) */
        #painelMaster { display: none; padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        header { 
            border-bottom: 2px solid var(--neon-blue); padding-bottom: 15px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        header h1 { font-family: 'Orbitron'; color: var(--neon-blue); margin: 0; font-size: 20px; }

        /* MENU DE ABAS */
        .menu-abas { display: flex; gap: 10px; margin-bottom: 20px; }
        .aba-btn { 
            background: #1a1d29; border: 1px solid #333; color: #777; padding: 12px 20px;
            cursor: pointer; font-family: 'Orbitron'; font-size: 12px; border-radius: 5px;
        }
        .aba-btn.ativa { border-color: var(--neon-blue); color: var(--neon-blue); background: rgba(0, 243, 255, 0.05); }

        /* SEÇÕES DE CONTEÚDO */
        .secao { display: none; background: var(--card); padding: 25px; border-radius: 10px; border: 1px solid #222; }
        .secao.ativa { display: block; }

        /* TABELAS */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { text-align: left; color: var(--neon-blue); padding: 12px; border-bottom: 2px solid #222; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #1a1d29; }

        /* FORMULÁRIO DE CADASTRO */
        .form-cadastro { display: flex; flex-direction: column; gap: 15px; max-width: 400px; }
        .form-cadastro input, .form-cadastro select {
            padding: 12px; background: #000; border: 1px solid #333; color: white; border-radius: 5px;
        }
        .btn-salvar { background: #00ff88; color: black; padding: 15px; border: none; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; border-radius: 5px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="telaLogin">
        <div class="login-box">
            <h2 style="font-family:'Orbitron'; color:var(--neon-blue); font-size:16px;">SANTANA ADM</h2>
            <input type="text" id="user" placeholder="USUÁRIO">
            <input type="text" id="pront" placeholder="PRONTUÁRIO">
            <input type="password" id="pass" placeholder="SENHA MASTER">
            <button class="btn-entrar" onclick="login()">ENTRAR NO SISTEMA</button>
            <p id="erro" style="color:var(--neon-red); font-size:12px; margin-top:10px; display:none;">DADOS INCORRETOS</p>
        </div>
    </div>

    <div id="painelMaster">
        <header>
            <h1>SANTANA TECH <span style="font-weight: 300; font-size: 12px; color: #444;">TERMINAL MASTER</span></h1>
            <button onclick="location.reload()" style="background:none; border:1px solid #333; color:#555; padding:5px 10px; cursor:pointer; font-size:10px;">SAIR</button>
        </header>

        <div class="menu-abas">
            <button id="btn-mon" class="aba-btn ativa" onclick="mudarPara('monitor')">MONITOR DE RESERVAS</button>
            <button id="btn-cad" class="aba-btn" onclick="mudarPara('cadastro')">CADASTRAR PROFESSORES</button>
        </div>

        <div id="secao-monitor" class="secao ativa">
            <h3 style="margin:0; font-size:14px; font-family:'Orbitron';">EQUIPAMENTOS EM USO</h3>
            <table>
                <thead>
                    <tr><th>PROFESSOR</th><th>LOCAL</th><th>INÍCIO</th><th>AÇÕES</th></tr>
                </thead>
                <tbody id="listaReservas"></tbody>
            </table>
        </div>

        <div id="secao-cadastro" class="secao">
            <h3 style="margin:0 0 20px 0; font-size:14px; font-family:'Orbitron'; color:var(--neon-blue);">REGISTRAR NOVO ACESSO NO BANCO</h3>
            
            <div class="form-cadastro">
                <input type="text" id="cad-nome" placeholder="Nome Completo do Professor">
                <input type="number" id="cad-pront" placeholder="Prontuário (Apenas números)">
                <select id="cad-cargo">
                    <option value="Professor">Professor(a)</option>
                    <option value="Coordenador">Coordenador(a)</option>
                    <option value="Gestor">Gestor(a)</option>
                </select>
                <button class="btn-salvar" onclick="salvarNoFirebase()">CADASTRAR NO SISTEMA</button>
            </div>

            <hr style="margin: 40px 0 20px 0; border: 0; border-top: 1px solid #222;">
            <h3 style="margin:0 0 10px 0; font-size:14px; font-family:'Orbitron';">PROFESSORES ATIVOS</h3>
            <table>
                <thead>
                    <tr><th>NOME</th><th>PRONTUÁRIO</th><th>CARGO</th><th>REMOVER</th></tr>
                </thead>
                <tbody id="listaUsuarios"></tbody>
            </table>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBoGFDKz-nBwKvczGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // LOGIN MASTER FIXO
    const MASTER = { u: "kelvin", p: "46690", s: "2683503205" };

    window.login = () => {
        const u = document.getElementById('user').value.toLowerCase();
        const p = document.getElementById('pront').value;
        const s = document.getElementById('pass').value;

        if(u === MASTER.u && p === MASTER.p && s === MASTER.s) {
            document.getElementById('telaLogin').classList.add('hidden');
            document.getElementById('painelMaster').style.display = 'block';
            carregarDados();
        } else {
            document.getElementById('erro').style.display = 'block';
        }
    };

    // TROCAR DE ABA (ESPAÇO)
    window.mudarPara = (onde) => {
        document.querySelectorAll('.secao').forEach(s => s.classList.remove('ativa'));
        document.querySelectorAll('.aba-btn').forEach(b => b.classList.remove('ativa'));
        
        if(onde === 'monitor') {
            document.getElementById('secao-monitor').classList.add('ativa');
            document.getElementById('btn-mon').classList.add('ativa');
        } else {
            document.getElementById('secao-cadastro').classList.add('ativa');
            document.getElementById('btn-cad').classList.add('ativa');
        }
    };

    // SALVAR NO BANCO
    window.salvarNoFirebase = () => {
        const nome = document.getElementById('cad-nome').value;
        const pront = document.getElementById('cad-pront').value;
        const cargo = document.getElementById('cad-cargo').value;

        if(!nome || !pront) return alert("Preencha o Nome e Prontuário!");

        set(ref(db, 'usuarios/' + pront), {
            nome: nome,
            pront: pront,
            cargo: cargo,
            senha: "pmsp" + pront, // Senha padrão
            status: "ativo"
        }).then(() => {
            alert("Sucesso! Professor " + nome + " já pode acessar.");
            document.getElementById('cad-nome').value = "";
            document.getElementById('cad-pront').value = "";
        });
    };

    function carregarDados() {
        // Reservas em Tempo Real
        onValue(ref(db, 'reservas'), (snap) => {
            const body = document.getElementById('listaReservas');
            body.innerHTML = "";
            const dados = snap.val();
            for(let id in dados) {
                const r = dados[id];
                body.innerHTML += `<tr>
                    <td><b>${r.prof}</b></td>
                    <td>${r.local || r.equipamento}</td>
                    <td>${r.inicio ? r.inicio.split(' ')[1] : '--:--'}</td>
                    <td><button onclick="removerReserva('${id}')" style="color:red; background:none; border:none; cursor:pointer;">DESLOGAR</button></td>
                </tr>`;
            }
        });

        // Lista de Usuários no Banco
        onValue(ref(db, 'usuarios'), (snap) => {
            const body = document.getElementById('listaUsuarios');
            body.innerHTML = "";
            const lista = snap.val();
            for(let p in lista) {
                const u = lista[p];
                body.innerHTML += `<tr>
                    <td>${u.nome}</td>
                    <td>${u.pront}</td>
                    <td>${u.cargo}</td>
                    <td><button onclick="removerUser('${p}')" style="color:#555; background:none; border:none; cursor:pointer;">APAGAR</button></td>
                </tr>`;
            }
        });
    }

    window.removerReserva = (id) => remove(ref(db, 'reservas/' + id));
    window.removerUser = (p) => confirm("Excluir acesso deste professor?") && remove(ref(db, 'usuarios/' + p));

</script>
</body>
</html>
