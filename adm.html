<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NTI - TERMINAL MASTER KELVIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-red: #ff0055; --bg-dark: #0a0b10; --card-dark: rgba(20, 22, 30, 0.95); }
        
        body { 
            margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg-dark); color: white;
            min-height: 100vh; overflow-x: hidden;
        }

        /* LOGIN SCREEN - ÚNICA COISA QUE APARECE AO ABRIR */
        #telaLogin {
            position: fixed; inset: 0; background: var(--bg-dark); z-index: 9999;
            display: flex; align-items: center; justify-content: center;
        }
        .login-box {
            background: var(--card-dark); border: 1px solid var(--neon-blue); border-radius: 15px;
            padding: 40px; width: 350px; text-align: center; box-shadow: 0 0 30px rgba(0, 243, 255, 0.2);
        }
        .login-box input {
            width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333;
            color: var(--neon-blue); border-radius: 5px; font-size: 18px; outline: none;
        }
        .btn-master {
            width: 100%; padding: 15px; background: var(--neon-blue); color: #000; border: none;
            border-radius: 5px; font-family: 'Orbitron'; font-weight: bold; cursor: pointer;
        }

        /* LAYOUT DO PAINEL */
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; display: none; }
        header { 
            padding: 20px 0; border-bottom: 2px solid var(--neon-blue); margin-bottom: 30px;
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { font-family: 'Orbitron', sans-serif; color: var(--neon-blue); margin: 0; font-size: 22px; }

        /* ABAS DE NAVEGAÇÃO */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 25px; }
        .tab-btn { 
            background: #161822; border: 1px solid #333; color: #888; padding: 12px 25px; 
            cursor: pointer; font-family: 'Orbitron'; font-size: 12px; border-radius: 5px; transition: 0.3s;
        }
        .tab-btn.active { border-color: var(--neon-blue); color: var(--neon-blue); background: rgba(0, 243, 255, 0.1); }

        .content-section { display: none; animation: fadeIn 0.5s ease; }
        .content-section.active { display: block; }

        /* ESTILO DOS CARDS E TABELAS */
        .card { background: var(--card-dark); border: 1px solid #1a1c26; border-radius: 10px; padding: 25px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; color: var(--neon-blue); padding: 15px; border-bottom: 2px solid #1a1c26; font-size: 13px; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #1a1c26; font-size: 16px; }

        /* FORMULÁRIO DE CADASTRO INTERNO */
        .grid-form { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end; }
        .grid-form input, .grid-form select { 
            background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 5px; outline: none;
        }
        .grid-form input:focus { border-color: var(--neon-blue); }
        .btn-save { background: #00ff88; color: #000; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="telaLogin">
        <div class="login-box">
            <h2 style="font-family:'Orbitron'; color:var(--neon-blue); font-size:16px; margin-bottom:20px;">AUTENTICAÇÃO NTI</h2>
            <input type="text" id="user" placeholder="USUÁRIO MASTER">
            <input type="text" id="pront" placeholder="PRONTUÁRIO">
            <input type="password" id="pass" placeholder="SENHA DE ACESSO">
            <button class="btn-master" onclick="autenticar()">DESBLOQUEAR SISTEMA</button>
            <p id="erro" style="color:var(--neon-red); font-size:12px; margin-top:15px; display:none;">CREDENCIAIS INCORRETAS</p>
        </div>
    </div>

    <div id="painelMaster" class="container">
        <header>
            <h1>SANTANA TECH <span style="font-weight: 300; font-size: 14px; color: #555;">| TERMINAL ADM</span></h1>
            <button onclick="location.reload()" style="background:none; border:1px solid var(--neon-red); color:var(--neon-red); padding:5px 15px; cursor:pointer; border-radius:4px; font-size:11px;">LOGOUT</button>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="mudarAba('monitor')">MONITOR DE RESERVAS</button>
            <button class="tab-btn" onclick="mudarAba('usuarios')">GESTÃO DE PROFESSORES</button>
        </nav>

        <section id="aba-monitor" class="content-section active">
            <div class="card">
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th>PROFESSOR</th>
                            <th>LOCAL / EQUIPAMENTO</th>
                            <th>RETIRADA</th>
                            <th>GERENCIAR</th>
                        </tr>
                    </thead>
                    <tbody id="listaReservas"></tbody>
                </table>
            </div>
        </section>

        <section id="aba-usuarios" class="content-section">
            <div class="card">
                <h3 style="margin: 0 0 20px 0; font-family: 'Orbitron'; font-size: 14px; color: var(--neon-blue);">REGISTRAR NOVO ACESSO</h3>
                <div class="grid-form">
                    <div>
                        <label style="font-size:11px; color:#555; display:block; margin-bottom:5px;">NOME COMPLETO</label>
                        <input type="text" id="cad-nome" placeholder="Ex: João Silva">
                    </div>
                    <div>
                        <label style="font-size:11px; color:#555; display:block; margin-bottom:5px;">PRONTUÁRIO</label>
                        <input type="number" id="cad-pront" placeholder="00000">
                    </div>
                    <div>
                        <label style="font-size:11px; color:#555; display:block; margin-bottom:5px;">CARGO</label>
                        <select id="cad-cargo">
                            <option value="Professor">Professor</option>
                            <option value="Coordenador">Coordenador</option>
                            <option value="Gestão">Gestão</option>
                        </select>
                    </div>
                    <button class="btn-save" onclick="salvarProfessor()">CADASTRAR</button>
                </div>
            </div>

            <div class="card">
                <h3 style="margin: 0 0 20px 0; font-family: 'Orbitron'; font-size: 14px; color: var(--neon-blue);">USUÁRIOS CADASTRADOS</h3>
                <table>
                    <thead>
                        <tr><th>NOME</th><th>PRONTUÁRIO</th><th>CARGO</th><th>AÇÃO</th></tr>
                    </thead>
                    <tbody id="listaUsuarios"></tbody>
                </table>
            </div>
        </section>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Configuração do seu banco
    const firebaseConfig = {
        apiKey: "AIzaSyBoGFDKz-nBwKvczGpxg-fHJYdVykcBUQ",
        authDomain: "escala-chacara.firebaseapp.com",
        databaseURL: "https://escala-chacara-default-rtdb.firebaseio.com",
        projectId: "escala-chacara",
        storageBucket: "escala-chacara.firebasestorage.app",
        messagingSenderId: "741259231706",
        appId: "1:741259231706:web:27e2b60be100e6a34180e3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // LOGIN MASTER
    const MASTER_KEY = { u: "kelvin", p: "46690", s: "2683503205" };

    window.autenticar = () => {
        const u = document.getElementById('user').value.toLowerCase();
        const p = document.getElementById('pront').value;
        const s = document.getElementById('pass').value;

        if(u === MASTER_KEY.u && p === MASTER_KEY.p && s === MASTER_KEY.s) {
            document.getElementById('telaLogin').classList.add('hidden');
            document.getElementById('painelMaster').style.display = 'block';
            carregarDados();
        } else {
            document.getElementById('erro').style.display = 'block';
        }
    };

    // NAVEGAÇÃO ENTRE ABAS
    window.mudarAba = (aba) => {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('aba-' + aba).classList.add('active');
        event.target.classList.add('active');
    };

    // LOGICA DE CADASTRO (SALVANDO NO FIREBASE)
    window.salvarProfessor = () => {
        const nome = document.getElementById('cad-nome').value;
        const pront = document.getElementById('cad-pront').value;
        const cargo = document.getElementById('cad-cargo').value;

        if(!nome || !pront) return alert("Preencha todos os campos!");

        set(ref(db, 'usuarios/' + pront), {
            nome: nome,
            pront: pront,
            cargo: cargo,
            senha: "pmsp" + pront, // Senha padrão inicial
            status: "ativo"
        }).then(() => {
            alert("Professor cadastrado com sucesso!");
            document.getElementById('cad-nome').value = "";
            document.getElementById('cad-pront').value = "";
        });
    };

    function carregarDados() {
        // Monitor de Reservas
        onValue(ref(db, 'reservas'), (snap) => {
            const lista = document.getElementById('listaReservas');
            lista.innerHTML = "";
            const dados = snap.val();
            for(let id in dados) {
                const r = dados[id];
                lista.innerHTML += `<tr>
                    <td><b style="color:#fff">${r.prof}</b></td>
                    <td>${r.local || r.equipamento}</td>
                    <td><span style="color:#00ff88">${r.inicio ? r.inicio.split(' ')[1] : '--:--'}</span></td>
                    <td><button onclick="removerReserva('${id}')" style="background:none; border:1px solid #ff0055; color:#ff0055; cursor:pointer; padding:3px 10px; border-radius:4px;">LIBERAR</button></td>
                </tr>`;
            }
        });

        // Lista de Usuários
        onValue(ref(db, 'usuarios'), (snap) => {
            const lista = document.getElementById('listaUsuarios');
            lista.innerHTML = "";
            const dados = snap.val();
            for(let p in dados) {
                const u = dados[p];
                lista.innerHTML += `<tr>
                    <td>${u.nome}</td>
                    <td>${u.pront}</td>
                    <td>${u.cargo}</td>
                    <td><button onclick="removerUser('${p}')" style="background:none; border:none; color:#555; cursor:pointer;">EXCLUIR</button></td>
                </tr>`;
            }
        });
    }

    window.removerReserva = (id) => remove(ref(db, 'reservas/' + id));
    window.removerUser = (p) => confirm("Excluir professor?") && remove(ref(db, 'usuarios/' + p));

</script>
</body>
</html>
